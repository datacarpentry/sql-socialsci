<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Data Management with SQL for Social Scientists *alpha*: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../site.webmanifest">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav data"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Data Carpentry" src="../assets/images/data-logo.svg"><abbr class="badge badge-light" title="This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback." style="background-color: #FFC700; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#field-testing-alpha-stage" class="external-link alert-link" style="color: #383838">
            <i aria-hidden="true" class="icon" data-feather="alert-triangle" style="border-radius: 5px"></i>
            Alpha
          </a>
          <span class="visually-hidden">This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="../assets/images/data-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Data Management with SQL for Social Scientists *alpha*
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Data Management with SQL for Social Scientists *alpha*
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="discuss.html">Discussion</a></li>
<li><a class="dropdown-item" href="reference.html">Glossary</a></li>
          </ul>
</li>
      </ul>
</div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
<input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset>
</form>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Data Management with SQL for Social Scientists *alpha*
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->
      
            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-relational-database.html">1. What is a relational database?</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-db-browser.html">2. Using DB Browser for SQLite</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-select.html">3. The Select Statement</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-missing-data.html">4. Missing Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-creating-new-columns.html">5. Creating New Columns</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-aggregation.html">6. Aggregations</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-creating-tables-views.html">7. Creating tables and views</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-sqlite-command-line.html">8. The SQLite command line</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-joins.html">9. Joins</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="10-other-environments.html">10. Using database tables in other environments</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="discuss.html">Discussion</a></li>
<li><a class="dropdown-item" href="reference.html">Glossary</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="../instructor/aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">
            
            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-relational-database"><p>Content from <a href="01-relational-database.html">What is a relational database?</a></p>
<hr>
<p>Last updated on 2023-05-02 |
        
        <a href="https://github.com/datacarpentry/sql-socialsci/edit/main/episodes/01-relational-database.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 15 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a relational database?</li>
<li>What is a table?</li>
<li>What is a data type?</li>
<li>Why do tables have key columns?</li>
<li>What different types of keys are there?</li>
<li>How does the database represent missing data?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Define a relational database</li>
<li>Compare with other types of databases</li>
<li>Understand the structure of a table</li>
<li>List the SQLite datatypes</li>
<li>Explain the purpose of a Schema</li>
<li>Explain Key fields</li>
<li>Understand the use of NULL</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="what-is-a-relational-database"><h2 class="section-heading">What is a relational database?<a class="anchor" aria-label="anchor" href="#what-is-a-relational-database"></a>
</h2>
<hr class="half-width">
<p>A relational database is a collection of data items organised as a
set of tables. Relationships can be defined between the data in one
table and the data in another or many other tables. The relational
database system will provide mechanisms by which you can query the data
in the tables, re-assemble the data in various ways without altering the
data in the actual tables. This querying is usually done using SQL
(Structured Query Language). SQL allows a great many queries to be
constructed from the use of only a few keywords. You could have a
relational database with only one table, but then you would not have any
relationships and it would be more like a spreadsheet. Databases are
designed to allow efficient querying against very large tables, more
than the 1M rows allowed in an Excel spreadsheet.</p>
</section><section id="what-is-a-table"><h2 class="section-heading">What is a table?<a class="anchor" aria-label="anchor" href="#what-is-a-table"></a>
</h2>
<hr class="half-width">
<p>As were have noted above, a single table is very much like a
spreadsheet. It has rows and it has columns. A row represents a single
observation and the columns represents the various variables contained
within that observation. Often one or more columns in a row will be
designated as a ‘primary key’ This column or combination of columns can
be used to uniquely identify a specific row in the table. The columns
typically have a name associated with them indicating the variable name.
A column always represents the same variable for each row contained in
the table. Because of this the data in each column will always be of the
same <em>type</em>, such as an Integer or Text, of values for all of the
rows in the table. Datatypes are discussed in the next section.</p>
</section><section id="what-is-a-data-type"><h2 class="section-heading">What is a data type?<a class="anchor" aria-label="anchor" href="#what-is-a-data-type"></a>
</h2>
<hr class="half-width">
<p>A data type is a description of the kind of data in a table column.
Each database system recognises its own set of datatypes, although some
are common to many. Typical examples will be Integer or Text.</p>
<p>The table below gives some examples.</p>
<table class="table">
<colgroup>
<col width="24%">
<col width="75%">
</colgroup>
<thead><tr class="header">
<th>Data type</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>CHARACTER(n)</td>
<td align="left">Character string. Fixed-length n</td>
</tr>
<tr class="even">
<td>Text</td>
<td align="left">Character string. Variable length</td>
</tr>
<tr class="odd">
<td>VARCHAR(n) or CHARACTER VARYING(n)</td>
<td align="left">Character string. Variable length. Maximum length
n</td>
</tr>
<tr class="even">
<td>BINARY(n)</td>
<td align="left">Binary string. Fixed-length n</td>
</tr>
<tr class="odd">
<td>BOOLEAN</td>
<td align="left">Stores TRUE or FALSE values</td>
</tr>
<tr class="even">
<td>VARBINARY(n) or BINARY VARYING(n)</td>
<td align="left">Binary string. Variable length. Maximum length n</td>
</tr>
<tr class="odd">
<td>INTEGER(p)</td>
<td align="left">Integer numerical (no decimal).</td>
</tr>
<tr class="even">
<td>SMALLINT</td>
<td align="left">Integer numerical (no decimal).</td>
</tr>
<tr class="odd">
<td>INTEGER</td>
<td align="left">Integer numerical (no decimal).</td>
</tr>
<tr class="even">
<td>BIGINT</td>
<td align="left">Integer numerical (no decimal).</td>
</tr>
<tr class="odd">
<td>DECIMAL(p,s)</td>
<td align="left">Exact numerical, precision p, scale s.</td>
</tr>
<tr class="even">
<td>NUMERIC(p,s)</td>
<td align="left">Exact numerical, precision p, scale s. (Same as
DECIMAL)</td>
</tr>
<tr class="odd">
<td>FLOAT(p)</td>
<td align="left">Approximate numerical, mantissa precision p. A floating
number in base 10 exponential notation.</td>
</tr>
<tr class="even">
<td>REAL</td>
<td align="left">Approximate numerical</td>
</tr>
<tr class="odd">
<td>FLOAT</td>
<td align="left">Approximate numerical</td>
</tr>
<tr class="even">
<td>DOUBLE PRECISION</td>
<td align="left">Approximate numerical</td>
</tr>
<tr class="odd">
<td>DATE</td>
<td align="left">Stores year, month, and day values</td>
</tr>
<tr class="even">
<td>TIME</td>
<td align="left">Stores hour, minute, and second values</td>
</tr>
<tr class="odd">
<td>TIMESTAMP</td>
<td align="left">Stores year, month, day, hour, minute, and second
values</td>
</tr>
<tr class="even">
<td>INTERVAL</td>
<td align="left">Composed of a number of integer fields, representing a
period of time, depending on the type of interval</td>
</tr>
<tr class="odd">
<td>ARRAY</td>
<td align="left">A set-length and ordered collection of elements</td>
</tr>
<tr class="even">
<td>MULTISET</td>
<td align="left">A variable-length and unordered collection of
elements</td>
</tr>
<tr class="odd">
<td>XML</td>
<td align="left">Stores XML data</td>
</tr>
</tbody>
</table>
<p>But in practice you can usually restrict your usage to a few</p>
<table class="table">
<colgroup>
<col width="24%">
<col width="75%">
</colgroup>
<thead><tr class="header">
<th>Data type</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>BOOLEAN</td>
<td align="left">Stores TRUE or FALSE values</td>
</tr>
<tr class="even">
<td>INTEGER</td>
<td align="left">Integer numerical (no decimal).</td>
</tr>
<tr class="odd">
<td>FLOAT</td>
<td align="left">Approximate numerical</td>
</tr>
<tr class="even">
<td>DATE</td>
<td align="left">Stores year, month, and day values</td>
</tr>
<tr class="odd">
<td>TIME</td>
<td align="left">Stores hour, minute, and second values</td>
</tr>
<tr class="even">
<td>TIMESTAMP</td>
<td align="left">Stores year, month, day, hour, minute, and second
values</td>
</tr>
</tbody>
</table>
<p>In SQLite there is only a small number.</p>
<table class="table">
<colgroup>
<col width="24%">
<col width="75%">
</colgroup>
<thead><tr class="header">
<th>Data type</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>NULL</td>
<td align="left">The value is a NULL value</td>
</tr>
<tr class="even">
<td>INTEGER</td>
<td align="left">The value is a signed integer, stored in 1, 2, 3, 4,
6,</td>
</tr>
<tr class="odd">
<td></td>
<td align="left">or 8 bytes depending on the magnitude of the value</td>
</tr>
<tr class="even">
<td>REAL</td>
<td align="left">The value is a floating point value, stored in
8-bytes</td>
</tr>
<tr class="odd">
<td>TEXT</td>
<td align="left">The value is a text string</td>
</tr>
<tr class="even">
<td>BLOB</td>
<td align="left">The data is stored exactly as it was input, Used for
binary</td>
</tr>
<tr class="odd">
<td></td>
<td align="left">data such as images.</td>
</tr>
</tbody>
</table>
<p>We won’t be using any BLOB data and it is debatable whether or not
NULL should be considered a type at all.</p>
<p>There are some common datatypes which are missing from the SQLite
list.</p>
<p>BOOL or BOOLEAN : This type typically accepts values of ‘True’ and
‘False’ In SQLite we would use the Integer type and assign values of 1
to represent ‘True’ and 0 to represent ‘False’.</p>
<p>DATE, DATETIME, TIMESTAMP : SQLite does not have a datatype for
storing dates and/or times. You can use TEXT, REAL, or INTEGER values
for these and use the built-in Date And Time Functions to manipulate
them. We will look at manipulating dates in Lesson 5.</p>
</section><section id="why-do-tables-have-primary-key-columns"><h2 class="section-heading">Why do tables have primary key columns?<a class="anchor" aria-label="anchor" href="#why-do-tables-have-primary-key-columns"></a>
</h2>
<hr class="half-width">
<p>Whenever you create a table, you will have the option of designating
one of the columns as the primary key column. The main property of the
primary key column is that the values contained in it must uniquely
identify that particular row. That is you cannot have duplicate primary
keys. This can be an advantage which adding rows to the table as you
will not be allowed to add the same row (or a row with the same primary
key) twice.</p>
<p>The primary key column for a table is usually of type Integer
although you could have Text. For example if you had a table of car
information, then the “Reg_No” column could be made the primary key as
it can be used to uniquely identify a particular row in the table.</p>
<p>A table doesn’t have to have a primary key although they are
recommended for larger tables. A primary key can also be made up of more
than one column, although this is less usual.</p>
</section><section id="what-different-types-of-keys-are-there"><h2 class="section-heading">What different types of keys are there?<a class="anchor" aria-label="anchor" href="#what-different-types-of-keys-are-there"></a>
</h2>
<hr class="half-width">
<p>In addition to the primary key, a table may have one or more
<em>Foreign keys</em>. A foreign key does not have to be unique or
identified as a foreign key when the table is created. A foreign key in
one table will relate to the primary key in another table. This allows a
relationship to be created between the two tables. If a table needs to
be related to several other tables, then there will be a foreign key
(column) for each of those tables.</p>
</section><section id="how-does-the-database-represent-missing-data"><h2 class="section-heading">How does the database represent missing data?<a class="anchor" aria-label="anchor" href="#how-does-the-database-represent-missing-data"></a>
</h2>
<hr class="half-width">
<p>All relational database systems have the concept of a NULL value.
NULL can be thought of as being of all data types or of no data type at
all. It represents something which is simply <em>not known</em>.</p>
<p>When you create a database table, for each column you are allowed to
indicate whether or not it can contain the NULL value. Like primary
keys, this can be used as a form of data validation.</p>
<p>In many real life situations you will have to accept that the data
isn’t perfect and will have to allow for NULL or missing values in your
table.</p>
<p>In DB Browser we can indicate how we want NULL values to be
displayed. We will use a RED background to the cell to make it stand
out. In SQL queries you can specifically test for NULL values.</p>
<p>We will look at missing data in more detail in a later episode.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>A relational database is data organised as a collection of related
tables</li>
<li>SQL (Structured Query Language) is used to extract data from the
tables. Either a single table or data spread across two or more related
tables.</li>
<li>A schema, which describes the data in a table, has to be created
before data can be added</li>
<li>The schema can be used to provide some data validation on input</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-02-db-browser"><p>Content from <a href="02-db-browser.html">Using DB Browser for SQLite</a></p>
<hr>
<p>Last updated on 2023-05-02 |
        
        <a href="https://github.com/datacarpentry/sql-socialsci/edit/main/episodes/02-db-browser.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 10 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What does the DB Browser for SQLite allow me to do?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the layout of the DB Browser for SQLite and the key
facilities that it provides</li>
<li>Connect to databases</li>
<li>Create new databases and tables</li>
<li>Run SQL queries</li>
<li>Export the results of queries</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="launching-db-browser"><h2 class="section-heading">Launching DB Browser<a class="anchor" aria-label="anchor" href="#launching-db-browser"></a>
</h2>
<hr class="half-width">
<p>In Windows the installation of DB Browser does not create a desktop
icon. To explicitly launch the application after installing it, use the
windows button (bottom left of screen) and type in ‘DB Browser’ in the
search bar and selecting the application when it appears.</p>
<figure><img src="../fig/DB_Browser_install_2.png" alt="DB Browser run" class="figure mx-auto d-block"></figure></section><section id="the-initial-screen"><h2 class="section-heading">The Initial screen<a class="anchor" aria-label="anchor" href="#the-initial-screen"></a>
</h2>
<hr class="half-width">
<p>The initial screen of DB Browser will look something like this, the
panes may be in a different configuration;</p>
<figure><img src="../fig/DB_Browser_run_1.png" alt="DB Browser initial screen" class="figure mx-auto d-block"></figure><p>There is;</p>
<p>A small menu system consisting of File, Edit, View and Help. Below
the menu system is a toolbar with four options; New Database, Open
Database, Write Changes and Revert Changes. Below the toolbar is a
4-tabbed pane for; Database Structure, Browse Data, Edit Pragmas and
Execute SQL. Initially these will be quite empty as we haven’t created
or opened a database yet. In general we will see how each of these are
used as we go through the lesson with the exception of the Edit Pragmas
tab which deals with system wide parameters which we won’t want to
change.</p>
<p>On the right hand side there are two further panes, at the top is the
Edit Database Cell pane which is grayed out. Below it is a 3-tabbed pane
for DB Schema, SQL log and Remote. We are only really interested in the
DB Schema tab.</p>
</section><section id="initial-changes-to-the-layout."><h2 class="section-heading">Initial changes to the layout.<a class="anchor" aria-label="anchor" href="#initial-changes-to-the-layout."></a>
</h2>
<hr class="half-width">
<p>The overall layout of DB Browser is quite flexible. The panes on the
right-hand side can be dragged and dropped into any position, the
individual tabs on the bottom pane closed directly from the pane and
re-opened from the menu View item.</p>
<p>We will make a couple of initial changes to the layout of the screen.
These will be retained across sessions.</p>
<ol style="list-style-type: decimal">
<li>From the View menu item un-select the ‘Edit Database Cell’ icon to
the left of the text. This will make the pane close and the bottom pane
will be expanded automatically to fill the space.</li>
<li><ol style="list-style-type: lower-alpha">
<li>On Windows, From the View menu item select ‘preferences’ and select
the Data Browser tab.</li>
</ol></li>
<li><ol start="2" style="list-style-type: lower-alpha">
<li>On Mac, From the “DB Browser for SQLite” menu item select
‘preferences’ and select the Data Browser tab.</li>
</ol></li>
</ol>
<figure><img src="../fig/DB_Browser_run_2.png" alt="Data Browser Preferences" class="figure mx-auto d-block"></figure><p>Towards the bottom there is a section dealing with Field colors. You
will see three bars below the word Text, to the right there are in fact
three invisible bars for the Background. Click in the area for the
Background color for NULL. A colour selector window will open, select
Red. The bar will turn Red. This is now the default background cell
colour that will be used to display NULL values in you tables. We will
discuss the meaning of NULL values in a table in a later episode.</p>
<p>You can now close the preference window by clicking OK.</p>
</section><section id="opening-a-database"><h2 class="section-heading">Opening a database<a class="anchor" aria-label="anchor" href="#opening-a-database"></a>
</h2>
<hr class="half-width">
<p>For this lesson we will be making extensive use of the SQL_SAFI
database. If you do not already have a copy of this database you can
download it from <a href="../data/SQL_SAFI.sqlite">here</a>.</p>
<p>To open the database in DB Browser do the following;</p>
<ol style="list-style-type: decimal">
<li>Click on the ‘open database’ button in the toolbar.</li>
<li>Navigate to where you have stored the database file on your local
machine, select it and click open.</li>
</ol>
<p>When you open the database, the ‘Database Structure’ tab on the left
and the ‘DB Schema’ pane on the right will look very similar. However
the ‘DB Schema’ pane is only there to allow you to see the details of
the schema for the tables. In particular what tables are in the database
and the fields and their types which are in each table.</p>
<p>The ‘Database Structure’ tab on the left allows you to initiate
actions on the tables. If you right click on a table name in the ‘DB
Schema’ pane, nothing happens. However, if you do the same in the
‘Database Structure’ menu you will be given a set of possible actions.
These are the same actions that are available from the toolbar at the
top of the tab.</p>
<figure><img src="../fig/DB_Browser_run_3.png" alt="Table Actions" class="figure mx-auto d-block"></figure><p>If you select ‘Browse Table’, the data from the table is loaded into
the ‘Browse Data’ pane from where it can be examined or filtered. You
can also select the table you wish to Browse directly from here.</p>
<p>There are options for ‘New Record’ and ‘Delete Record’. As our
interest is in analysing existing data not creating or deleting data, it
is unlikely that you will want to use these options.</p>
</section><section id="running-sql-queries"><h2 class="section-heading">Running SQL Queries<a class="anchor" aria-label="anchor" href="#running-sql-queries"></a>
</h2>
<hr class="half-width">
<p>We will be running queries extensively in future episodes. For now we
will just provide an outline of the environment.</p>
<p>In the left hand pane if you select the Execute SQL tab, you will be
presented with a three paned window and a small toolbar. The top pane is
itself tabbed with the initial tab labeled ‘SQL 1’. This is the SQL
editor pane into which you will type your queries.</p>
<p>Below is a simple example query and the results.</p>
<figure><img src="../fig/DB_Browser_run_4.png" alt="SQL Query results" class="figure mx-auto d-block"></figure><p>Notice that the query has been written over multiple lines. This is
commonly done to aid readability. The second pane has the tabular
results, and the bottom pane has a message indicating how many rows were
returned, how long it took and a copy of the SQL statement that was
executed.</p>
<p>On the toolbar at the top there are eight buttons. Left to right they
are:</p>
<ul>
<li>Open Tab (creates a new tab in the editor)</li>
<li>Open SQL file (allows you to load a prepared file of SQL into the
editor - the tab takes the name of he file)</li>
<li>Save SQL file (allows you to save the current contents of the active
pane to the local file system)</li>
<li>Execute SQL (Executes all of the SQL statements in the editor
pane)</li>
<li>Execute current line (Actually executes whatever is selected)</li>
<li>Save Results (Either to a CSV file or as a database view. We will
look at views in a later episode)</li>
<li>Find (Text in the editor window)</li>
<li>Find &amp; Replace (Text in the editor window)</li>
</ul>
<p>Because it is possible to have and execute multiple SQL statements in
the same editor pane, each must be terminated with a ‘;’. If you only
have a single statement you don’t need it, but it might be considered
best practice to always include it.</p>
<p>The pane below the editor is the Results pane. The results of running
your query will appear here in a simple tabular format. The bottom pane
is for messages about the execution, either an error message or an
indication of how many rows were returned by the query.</p>
</section><section id="creating-a-database"><h2 class="section-heading">Creating a database<a class="anchor" aria-label="anchor" href="#creating-a-database"></a>
</h2>
<hr class="half-width">
<p>As well as opening (connecting) to existing databases it is also
possible to create new SQLite databases and tables using DB Browser. To
create a database click the New Database button from the main toolbar
(also available from the File menu). You will initially be asked for a
name for the database and where you want to save it. It is saved as a
single file. You can choose your own extension but ‘sqlite’ is
recommended. If you do not provide a default, then a ‘.db’ extension
will be used. Although the new database is empty, in that there are no
tables in it, the <code>.sqlite</code> file itself is not empty.</p>
<p>Once you have saved the database file the Create Table wizard will
open allowing you to create a table. You can cancel this as we will be
going through the create table process in a later episode.</p>
</section><section id="write-changes-revert-changes"><h2 class="section-heading">Write Changes &amp; Revert Changes<a class="anchor" aria-label="anchor" href="#write-changes-revert-changes"></a>
</h2>
<hr class="half-width">
<p>Much of our SQL work involves looking at existing data using SQL
queries and possibly writing out the results to a CSV file, in general
we will not be changing the contents of the database.</p>
<p>However if, during your DB Browser session, you were to create or
delete a table or create a view, then the changes are not automatically
written to the database file.</p>
<p>When you try to end the session (i.e. close the application) in which
you have made such changes, then you will be asked if you want to save
the changes you have made. Alternatively you can explicitly save changes
or revert changes during a session by use of the Write Changes and
Revert Changes buttons on the toolbar. Once written the changes are
permanent (there is no concept of multiple ‘undo’ like you might have in
other programs). Revert Changes will take you back to the last Written
copy.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>The DB Browser for SQLite application allows you to connect to an
existing database or create a new database</li>
<li>When connected to a database you can create new tables</li>
<li>When connected to a database you can write and run SQL queries and
view the results</li>
<li>You can save the results of a query to a file</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-03-select"><p>Content from <a href="03-select.html">The Select Statement</a></p>
<hr>
<p>Last updated on 2023-05-02 |
        
        <a href="https://github.com/datacarpentry/sql-socialsci/edit/main/episodes/03-select.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 25 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is SQL?</li>
<li>How can I return specific columns from a table?</li>
<li>How can I return specific rows from a table?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Define SQL</li>
<li>Explain how SQL is used to access relational database tables</li>
<li>Understand the difference between DDL and DML</li>
<li>Create simple SQL queries to return rows and columns from existing
tables</li>
<li>Construct more complex logical expressions for use in WHERE
clauses</li>
<li>Return sorted results from a query</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="definition-of-sql"><h2 class="section-heading">Definition of SQL<a class="anchor" aria-label="anchor" href="#definition-of-sql"></a>
</h2>
<hr class="half-width">
<p>SQL or Structured Query Language is an international standard for
manipulating data in a relational database. Each Relational Database
system like Oracle, MySQL or SQLite implements its own variation of the
standard.</p>
<p>Fortunately for the types of commands and queries that we will want
to write, all of the implementations are much in agreement. The SELECT
queries we will be writing to access data in our SQLite database will
execute un-altered in many of the other environments.</p>
<p>Essentially you only have to learn SQL once.</p>
</section><section id="sql-and-relational-database-tables"><h2 class="section-heading">SQL and Relational database tables<a class="anchor" aria-label="anchor" href="#sql-and-relational-database-tables"></a>
</h2>
<hr class="half-width">
<p>The strength of SQL is that a single SQL statement or query can
request data be returned from one or many of the tables in the database.
You can essentially define the relationships between tables on-the-fly
as part of your query statement. Relationships between tables are often
included as part of the overall database design. In our situation we may
be getting an assortment of tables from different sources so being able
to imply the relationship as part of the query has definite
advantages.</p>
</section><section id="ddl-and-dml"><h2 class="section-heading">DDL and DML<a class="anchor" aria-label="anchor" href="#ddl-and-dml"></a>
</h2>
<hr class="half-width">
<p>DDL stands for Data Definition Language. It is the set of SQL
commands used to create, alter or delete database objects such as
tables.</p>
<p>DML stands for Data Manipulation Language. For our purposes this is
the SELECT command which is used to extract data items from one or more
of the database tables.</p>
</section><section id="simple-sql-queries-using-the-select-statement"><h2 class="section-heading">Simple SQL queries using the Select statement<a class="anchor" aria-label="anchor" href="#simple-sql-queries-using-the-select-statement"></a>
</h2>
<hr class="half-width">
<p>For the rest of this episode we will be looking at the SELECT
statement.</p>
<p>To follow along, you should open the DB Browser application and
connect to the SQL_SAFI database.</p>
<p>In SQL, querying data is performed by a SELECT statement. A select
statement has 6 key components;</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> colnames</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> tablename</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> conditions</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> colnames</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> conditions</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> colnames</span></code></pre>
</div>
<p>In practice very few queries will have all of these clauses in them
simplifying many queries. On the other hand, conditions in the WHERE
clause can be arbitrarily complex and if you need to JOIN two or more
tables together then more clauses (JOIN and ON) are needed.</p>
<p>All of the clause names above have been written in uppercase for
clarity. SQL is not case sensitive. Neither do you need to write each
clause on a new line, but it is often clearer to do so for all but the
simplest of queries.</p>
<p>In this episode we will start with the very simple and work our way
up to the more complex.</p>
<p>The simplest query is effectively one which returns the contents of
the whole table</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms;</span></code></pre>
</div>
<p>It is better practice and generally more efficient to explicitly list
the column names that you want returned.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> Country, A06_province, A07_district, A08_ward, A09_village</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms;</span></code></pre>
</div>
<p>The ‘*’ character acts as a wildcard meaning all of the columns but
you cannot use it as a general wildcard. So for example, the following
is not valid.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A<span class="op">*</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms;</span></code></pre>
</div>
<p>If you run it you will get an error. When an error does occur you
will see an error message displayed in the bottom pane.</p>
<p>In addition to limiting the columns returned by a query, you can also
limit the rows returned. The simplest case is to say how many rows are
wanted using the <code>LIMIT</code> clause. In the example below only
the first ten rows of the result of the query will be returned. This is
useful if you just want to get a feel for what the data looks like.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre>
</div>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise"></a>
</h3>
<div class="callout-content">
<p>Write a query which returns the first 5 rows from the Farms table
with only the columns Id, and B16 to B20.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>  <span class="kw">Id</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>     , B16_years_liv</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>   , B17_parents_liv</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>   , B18_sp_parents_liv</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>   , B19_grand_liv</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>   , B20_sp_grand_liv</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">5</span>;</span></code></pre>
</div>
<p>Because the query uses several columns (with longish names), for
readability they have been set out on separate lines. SQL takes of white
space to you are free to arrange the text of the query as you like.</p>
</div>
</div>
</div>
</div>
</section><section id="the-where-clause"><h2 class="section-heading">The <code>WHERE</code> clause<a class="anchor" aria-label="anchor" href="#the-where-clause"></a>
</h2>
<hr class="half-width">
<p>Usually you will want to restrict the rows returned based on some
criteria. i.e. certain values or ranges within one or more columns.</p>
<p>In this example we are only interested in rows where the value in the
B16_years_liv column is greater than 25</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>  <span class="kw">Id</span>, B16_years_liv</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> B16_years_liv <span class="op">&gt;</span> <span class="dv">25</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>In addition to using the ‘&gt;’ we can use many other operators such
as &lt;, &lt;=, =, &gt;=, &lt;&gt;</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>  <span class="kw">Id</span>, B17_parents_liv</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> B17_parents_liv <span class="op">=</span> <span class="st">'yes'</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
</section><section id="using-more-complex-logical-expressions-in-the-where-clause"><h2 class="section-heading">Using more complex logical expressions in the <code>WHERE</code>
clause<a class="anchor" aria-label="anchor" href="#using-more-complex-logical-expressions-in-the-where-clause"></a>
</h2>
<hr class="half-width">
<p>We can also use the AND and OR keywords to build more complex
selection criteria.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>  <span class="kw">Id</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span>    B17_parents_liv <span class="op">=</span> <span class="st">'yes'</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>     <span class="kw">AND</span> B18_sp_parents_liv <span class="op">=</span> <span class="st">'yes'</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>     <span class="kw">AND</span> B19_grand_liv <span class="op">=</span> <span class="st">'yes'</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">AND</span> B20_sp_grand_liv <span class="op">=</span> <span class="st">'yes'</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>Notice that the columns being used in the <code>WHERE</code> clause
do not need to returned as part of the <code>SELECT</code> clause.</p>
<p>You can ensure the precedence of the operators by using brackets.
Judicious use of brackets can also aid readability</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>  <span class="kw">Id</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> (B17_parents_liv <span class="op">=</span> <span class="st">'yes'</span> <span class="kw">OR</span> B18_sp_parents_liv <span class="op">=</span> <span class="st">'yes'</span>) <span class="kw">AND</span> B16_years_liv <span class="op">&gt;</span> <span class="dv">60</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<div id="exercise-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-1" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise-1"></a>
</h3>
<div class="callout-content">
<p>From the above query, breakdown the <code>WHERE</code> clause so that
each component can be tested individually. Make a note of how many rows
are returned in each case.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>To test each of the <code>OR</code> clauses</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>  <span class="kw">Id</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> B17_parents_liv <span class="op">=</span> <span class="st">'yes'</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>;</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>  <span class="kw">Id</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> B18_sp_parents_liv <span class="op">=</span> <span class="st">'yes'</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>  <span class="kw">Id</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> (B17_parents_liv <span class="op">=</span> <span class="st">'yes'</span> <span class="kw">OR</span> B18_sp_parents_liv <span class="op">=</span> <span class="st">'yes'</span>) </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>;</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>  <span class="kw">Id</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> B16_years_liv <span class="op">&gt;</span> <span class="dv">60</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p><code>OR</code> generally creates a less restrictive condition and
<code>AND</code> makes a more restrictive condition.</p>
</div>
</div>
</div>
</div>
<p>The following query returns the rows where the value of B16_years_liv
is in the range 51 to 59 inclusive.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">Id</span>, B16_years_liv</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> B16_years_liv <span class="op">&gt;</span> <span class="dv">50</span> <span class="kw">AND</span> B16_years_liv <span class="op">&lt;</span> <span class="dv">60</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>The same results could be obtained by using the BETWEEN or IN
operators</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">Id</span>, B16_years_liv</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> B16_years_liv <span class="kw">BETWEEN</span> <span class="dv">51</span> <span class="kw">AND</span> <span class="dv">59</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">Id</span>, B16_years_liv</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> B16_years_liv <span class="kw">IN</span> (<span class="dv">51</span>, <span class="dv">52</span>, <span class="dv">53</span>, <span class="dv">54</span>, <span class="dv">55</span>, <span class="dv">56</span>, <span class="dv">57</span>, <span class="dv">58</span>, <span class="dv">59</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>The list of values in brackets do not have to be contiguous or even
in order.</p>
<div id="exercise-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-2" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise-2"></a>
</h3>
<div class="callout-content">
<p>Write a query using the Farms table which returns the columns Id,
A09_village, A11_years_farm, B16_years_liv. We are only interested in
rows where the A09_village value is either ‘God’ or ‘Ruaca’.
Additionally we only want A11_years_farm values in the range 20 to 30
exclusive and B16_years_liv values strictly greater than 40. There are
many ways of doing this, but try to use an inequality, an
<code>IN</code> clause and a <code>BETWEEN</code> clause.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<pre><code>SELECT Id, A09_village, A11_years_farm, B16_years_liv
FROM Farms
WHERE     A09_village IN ('God', 'Ruaca') 
      AND A11_years_farm BETWEEN 21 AND 29 
      AND B16_years_liv &gt; 40
;</code></pre>
</div>
</div>
</div>
</div>
</section><section id="sorting-results"><h2 class="section-heading">Sorting results<a class="anchor" aria-label="anchor" href="#sorting-results"></a>
</h2>
<hr class="half-width">
<p>If you want the results of your query to appear in a specific order,
you can use the ORDER BY clause</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">Id</span>, A09_village, A11_years_farm, B16_years_liv</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> A09_village <span class="op">=</span> <span class="st">'God'</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> A11_years_farm</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>By default the SQL assumes Ascending order. You can make this more
explicit by using the <code>ASC</code> or <code>DESC</code>
keywords.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">Id</span>, A09_village, A11_years_farm, B16_years_liv</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> A09_village <span class="op">=</span> <span class="st">'God'</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> A11_years_farm <span class="kw">DESC</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>You can also order by multiple columns</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">Id</span>, A09_village, A11_years_farm, B16_years_liv</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> A09_village <span class="op">=</span> <span class="st">'God'</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> A11_years_farm <span class="kw">DESC</span> , B16_years_liv <span class="kw">ASC</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Strictly speaking SQL is a standard, not a particular
implementation</li>
<li>SQL implementation are sufficiently close that you only have to
learn SQL once</li>
<li>The DDL constructs are used to create tables and other database
objects</li>
<li>The DML constructs, typically the SELECT statement is used to
retrieve data from one or more tables</li>
<li>The SELECT statement allows you to ‘slice’ and ‘dice’ the columns
and rows of the dataset so that the query only returns the data of
interest</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-04-missing-data"><p>Content from <a href="04-missing-data.html">Missing Data</a></p>
<hr>
<p>Last updated on 2023-05-02 |
        
        <a href="https://github.com/datacarpentry/sql-socialsci/edit/main/episodes/04-missing-data.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 10 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I deal with missing data?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Recognise what the database sees as missing data</li>
<li>Understand that the original data source may represent missing data
differently</li>
<li>Define strategies for dealing with missing data</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="how-does-the-database-represents-missing-data"><h2 class="section-heading">How does the database represents missing data<a class="anchor" aria-label="anchor" href="#how-does-the-database-represents-missing-data"></a>
</h2>
<hr class="half-width">
<p>At the beginning of this lesson we noted that all database systems
have the concept of a NULL value; Something which is missing and nothing
is known about it.</p>
<p>In DB Browser we can choose how we want NULLs in a table to be
displayed. When we had our initial look at DB Browser, we used the
<code>View | Preference</code> option to change the background colour of
cells in a table which has a <code>NULL</code> values as
<strong>red</strong>. The example below, using the ‘Browse data’ tab,
shows a section of the Farms table in the SQL_SAFI database showing
column values which are <code>NULL</code>.</p>
<figure><img src="../fig/SQL_04_Nulls_01.png" alt="Farms NULLs" class="figure mx-auto d-block"></figure><p>If you type ‘=NULL’ in the filter box for
<code>F14_items_owned</code>, only the rows with NULL in
<code>F14_items_owned</code> will be displayed.</p>
<p>You can get the same results using the following query;</p>
<pre><code>SELECT *
FROM Farms
WHERE F14_items_owned IS NULL
;</code></pre>
<p>Notice that we use <code>IS</code> and not <code>=</code>. This is
because ‘NULL’ equals nothing and everything all at the same time!</p>
<p>This table was created from a csv file, part of which looks like
this</p>
<figure><img src="../fig/SQL_04_Nulls_02.png" alt="Farms_csv" class="figure mx-auto d-block"></figure><p>The highlighted area shows part of the record with Id = 21, the
second record returned by the query. It starts with the ‘F10_liv_owned’
column and ends with the ‘G01_no_meals’ column. The Arrow points to the
two consecutive ‘,’s representing the lack of a value for the
’F14_items_owned’ column. These values are missing from the data.</p>
</section><section id="reasons-for-missing-data"><h2 class="section-heading">Reasons for Missing data<a class="anchor" aria-label="anchor" href="#reasons-for-missing-data"></a>
</h2>
<hr class="half-width">
<p>There can be many reasons why data is missing; Not collected, lost,
Not applicable etc. In the case of our Farms table, many of the missing
values have occurred as a result of the survey design.</p>
<p>If you run the following query :</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> E01_water_use, E_no_group_count, E_yes_group_count</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>The first part of the results will look like this:</p>
<figure><img src="../fig/SQL_04_Nulls_04.png" alt="Farms_csv" class="figure mx-auto d-block"></figure><p>You may be able to spot from this the relationship between the values
in the <code>E01_water_use</code> column and whether or not there is a
<code>NULL</code> value in either the <code>E_no_group_count</code> or
the <code>E_yes_group_count</code> column.</p>
<p>Only if the Farmer said that they did use water (E01_water_use =
‘yes’) they were asked how many plots they used water on and the value
stored in E_yes_group_count otherwise this field was not even presented
in the survey and so contains a <code>NULL</code> value. In this
situation we expect <code>NULL</code> values and they will not cause any
problems.</p>
<p>However the <code>F14_items_owned</code> column records the
possessions of the Farmer. This question was always asked. It is not
clear from the <code>NULL</code> values we find in this field whether or
not it means ‘I have no possessions’ or ‘I do not wish to tell you what
possessions I have’, in short, we know nothing about the items owned and
therefore the value of <code>NULL</code> is appropriate.</p>
</section><section id="dealing-with-missing-data"><h2 class="section-heading">Dealing with missing data<a class="anchor" aria-label="anchor" href="#dealing-with-missing-data"></a>
</h2>
<hr class="half-width">
<p>There are several statistical techniques that can be used to allow
for <code>NULL</code> values, which one you might will depend on what
has caused the <code>NULL</code> value to be recorded.</p>
<p>You may want to change the <code>NULL</code> value to something else.
For example if we knew that the <code>NULL</code> values in the
<code>F14_items_owned</code> column actually meant that the Farmer had
no possessions then we might want to change the <code>NULL</code> values
to ‘[]’ to represent and empty list. We can do that in SQL with an
<code>UPDATE</code> query.</p>
<p>The update query is shown below. We are not going to run it as it
would change our data. You need to be very sure of the effect you are
going to have before you change data in this way.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">UPDATE</span> Farms</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> F14_items_owned <span class="op">=</span> <span class="st">'[]'</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> F14_items_owned <span class="kw">is</span> <span class="kw">NULL</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>Rather than changing the data we may just want to miss it out of our
analysis.</p>
<p>We can write a query which excludes the rows where
<code>F14_items_owned</code> has a <code>NULL</code> value with:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">from</span> Farms</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> F14_items_owned <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>You should expect missing data</li>
<li>You need to know how missing data is being represented in your
dataset</li>
<li>Database systems always represent what they consider to be missing
data as <code>NULL</code>
</li>
<li>You can explicitly test for <code>NULL</code> values in your
data</li>
<li>You may need other tests for different representations of
<code>NULL</code>
</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-05-creating-new-columns"><p>Content from <a href="05-creating-new-columns.html">Creating New Columns</a></p>
<hr>
<p>Last updated on 2023-05-02 |
        
        <a href="https://github.com/datacarpentry/sql-socialsci/edit/main/episodes/05-creating-new-columns.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I add new columns with derived values in the query
results?</li>
<li>How can I give a column a new name?</li>
<li>How do I use built-in functions to create new values?</li>
<li>How can I create binned results?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Create new columns in the query output</li>
<li>Rename columns in the query output</li>
<li>Use built-in functions to create new values</li>
<li>Use SQL syntax to conditionally create new values</li>
<li>Use SQL syntax to create a new column of ‘binned’ values</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="creating-new-columns"><h2 class="section-heading">Creating new columns<a class="anchor" aria-label="anchor" href="#creating-new-columns"></a>
</h2>
<hr class="half-width">
<p>In addition to selecting existing columns from a table, you can also
create new columns in the query output based on the existing columns.
These new columns only exist in the output. The table used in the query
is not changed in any way.</p>
<p>The Plots table contains a column, <code>D02_total_plot</code>
representing the area of the plot and the <code>D03_unit_land</code>
column gives the units. In our sample dataset the unit is always
‘hectare’. However in the full dataset some of the plot areas are
recorded in ‘acres’. We want to create a new output column which shows
the hectare value converted into acres. To do this we could use the
following SQL. ( 1 hectare = 2.4701 acres)</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> D02_total_plot <span class="op">*</span> <span class="fl">2.4701</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Plots</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>Running this query will give the correct answers, but it uses the
expression used in creating the new column as the column name. This
looks very messy, especially if the expression is long. It is always the
case that if you create a column in the results of the query it won’t
have a name by default. SQL will create one for it. Other relational
databases take different approaches to the problem and will
pseudo-randomly name the new columns for you with such things as ‘_c0’.
SQLite uses the expression you used to create the column name.</p>
</section><section id="renaming-columns-using-aliases"><h2 class="section-heading">Renaming columns using aliases<a class="anchor" aria-label="anchor" href="#renaming-columns-using-aliases"></a>
</h2>
<hr class="half-width">
<p>Given that creating new columns is so commonly done, SQL does provide
a mechanism for giving them names of your choice. This is done using the
<strong>AS</strong> clause</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> D02_total_plot <span class="op">*</span> <span class="fl">2.4701</span> <span class="kw">AS</span> D02_total_plot_converted</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Plots</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>The <strong>AS</strong> keyword itself is optional. You can just put
the name of the new column, but using the <strong>AS</strong> keyword
adds clarity. Creating column names in this way is referred to as adding
an alias. This may seem a bit strange for columns which had no real name
in the first place, but the point is, you can give any table column name
an alias to be used in the output rather than the original.</p>
</section><section id="using-built-in-functions-to-create-new-values"><h2 class="section-heading">Using built-in functions to create new values<a class="anchor" aria-label="anchor" href="#using-built-in-functions-to-create-new-values"></a>
</h2>
<hr class="half-width">
<p>In addition to using simple arithmetic operations to create new
columns, you can also use some of the SQLite built-in functions. Full
details of the available built-in functions are available from the
SQLite.org website <a href="https://sqlite.org/lang_corefunc.html#instr" class="external-link">here</a>.</p>
<p>We will look at some of the arithmetic and statistical functions when
we deal with aggregations in a later lesson.</p>
<p>You may have noticed in the output from are last query that the
number of decimal places can change from one row to another. In order to
make the output more tidy, we may wish to always produce the same number
of decimal places, e.g. 2. We can do this using the <code>ROUND</code>
function.</p>
<p>The <code>ROUND</code> function works in a similar way as its
spreadsheet equivalent, you specify the value you wish to round and the
required number of decimal places.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">ROUND</span>(D02_total_plot <span class="op">*</span> <span class="fl">2.4701</span>, <span class="dv">2</span>) <span class="kw">as</span> D02_total_plot_converted</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Plots</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise"></a>
</h3>
<div class="callout-content">
<p>Write an SQL query which returns the Id, plot_Id, D01_curr_plot and
D02_total_plot columns from the Plots table with the addition of a
calculated column representing the plot area in acres and a column
representing the units of the calculated column.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">Id</span>, plot_Id, D01_curr_plot, D02_total_plot,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">ROUND</span>(D02_total_plot <span class="op">*</span> <span class="fl">2.4701</span>, <span class="dv">2</span>) <span class="kw">AS</span> D02_total_plot_converted,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'acres'</span> <span class="kw">AS</span> D03_unit_land_converted</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Plots</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>Notice that we can use columns as part of the calculated column which
are not returned in the output. Also our second new column doesn’t
actually need to make use of any of the other columns, it can just be a
value.</p>
</div>
</div>
</div>
</div>
<p>We will now look at a couple of the more common text functions. These
have equivalents in other programming languages or spreadsheet systems,
sometimes with different names.</p>
<table class="table">
<thead><tr class="header">
<th>SQLite function</th>
<th align="left">Excel equivalent</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>substr(a,b,c)</td>
<td align="left">mid(a,b,c)</td>
</tr>
<tr class="even">
<td>instr(a,b)</td>
<td align="left">find(a,b)</td>
</tr>
</tbody>
</table>
<p><code>instr</code> can be used to check a character or string of
characters occurs within another string. <code>substr</code> can be used
to extract a portion of a string based on a starting position and the
number of characters required.</p>
<p>In the Farms table, the three columns A01_interview_date, A04_start
and A05_end are all recognisable as a dates with the A04_start and
A05_end also including times. These last two are automatically generated
by the eSurvey software when the data is collected, i.e. they are
automatically entered. The A01_interview_date however is manually input.
In all three cases however SQLite thinks that they are all just strings
of characters. We can confirm this by selecting the
<code>Database Structure</code> tab and expanding the <code>Farms</code>
entry and notice that the data type for all three columns is listed as
‘TEXT’</p>
<p>To see what these columns look like you can run the following
query;</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A01_interview_date, A04_start, A05_end</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>The format of the A04_start and A05_end columns follow the <a href="https://en.wikipedia.org/wiki/ISO_8601" class="external-link">ISO 8601</a>. The
A01_interview_date column on the other hand uses the shorthand
dd/mm/yyyy format.</p>
<p>The drawback of having dates represented by strings occurs when you
want to sort them. In SQL you can sort the output of your query by using
an <code>ORDER BY</code> clause at the end of the select statement.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A01_interview_date</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> A01_interview_date</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>NB. we are using the UK and European representation of dates in this
discussion. The same issue will occur if you were using US date
formats.</p>
<p>It is unlikely that the result of the above query is what you wanted.
‘01/07/2017’ has been ordered before ‘01/12/2016’. This is because the
sorting process treats the dates as simple strings and a ‘0’ in the
month position is less than a ‘1’ in the months position.</p>
<p>In order to sort the A01_interview_date column into date order we
need to make SQLite see it as a date. SQLite does have a date function.
Unfortunately by itself, it won’t work on A01_interview_date.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A01_interview_date, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>       <span class="dt">date</span>(A01_interview_date) <span class="kw">AS</span> converted_A01,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>       A04_start,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>       <span class="dt">date</span>(A04_start) <span class="kw">AS</span> coverted_A04</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>Although it doesn’t produce an error, the attempted conversion of
A01_interview_date into a date format has failed. A set of NULLs was
returned.</p>
<figure><img src="../fig/SQL_05_dates_01.png" alt="Conversion failure" class="figure mx-auto d-block"></figure><p>On the other hand the A04_start conversion did work. The problem is
that the date function expects the string to be converted to be in a
certain format like ISO-8601.</p>
<p>We need to change the way A01_interview_date looks. Instead of
dd/mm/yyyy we need yyyy-mm-dd. To do this we can use the
<code>substr</code> function along with the <code>||</code> operator
which is used to concatenate strings together.</p>
<p>We can extract individual parts of the date like this;</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A01_interview_date,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">7</span>,<span class="dv">4</span>) <span class="kw">as</span> <span class="dt">year</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">4</span>,<span class="dv">2</span>) <span class="kw">as</span> <span class="dt">month</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">1</span>,<span class="dv">2</span>) <span class="kw">as</span> <span class="dt">day</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>But in order to convert it into a date we need all three parts
concatenated together along with ‘-’ to separate the parts.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A01_interview_date,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">7</span>,<span class="dv">4</span>) <span class="op">||</span> <span class="st">'-'</span> <span class="op">||</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">4</span>,<span class="dv">2</span>) <span class="op">||</span> <span class="st">'-'</span> <span class="op">||</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">1</span>,<span class="dv">2</span>) <span class="kw">as</span> converted_date</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>We can then convert our new string containing the date into a proper
date by passing it to the <code>date</code> function.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A01_interview_date,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>       <span class="dt">date</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">7</span>,<span class="dv">4</span>) <span class="op">||</span> <span class="st">'-'</span> <span class="op">||</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">4</span>,<span class="dv">2</span>) <span class="op">||</span> <span class="st">'-'</span> <span class="op">||</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>       ) <span class="kw">as</span> converted_date</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>We can now use our <code>converted_date</code> column to sort by</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A01_interview_date,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>       <span class="dt">date</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">7</span>,<span class="dv">4</span>) <span class="op">||</span> <span class="st">'-'</span> <span class="op">||</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">4</span>,<span class="dv">2</span>) <span class="op">||</span> <span class="st">'-'</span> <span class="op">||</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>       ) <span class="kw">as</span> converted_date</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> converted_date</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<div id="exercise-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-1" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise-1"></a>
</h3>
<div class="callout-content">
<p>Change the query above to sort by the <code>A01_interview_date</code>
field and compare the results</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A01_interview_date,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>       <span class="dt">date</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">7</span>,<span class="dv">4</span>) <span class="op">||</span> <span class="st">'-'</span> <span class="op">||</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">4</span>,<span class="dv">2</span>) <span class="op">||</span> <span class="st">'-'</span> <span class="op">||</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>       ) <span class="kw">as</span> converted_date</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> A01_interview_date</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>In the Spreadsheets lesson we discussed that splitting dates into
year, month and day components was a good way of making the meaning of
the date parts unambiguous. Our first SQL query for the date conversion
did this;</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A01_interview_date,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">7</span>,<span class="dv">4</span>) <span class="kw">as</span> <span class="dt">year</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">4</span>,<span class="dv">2</span>) <span class="kw">as</span> <span class="dt">month</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">1</span>,<span class="dv">2</span>) <span class="kw">as</span> <span class="dt">day</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>Having the date components split in this way does not prevent us from
sorting them. We just need to specify all of the columns we want to sort
by in the order in which we want them sorted.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A01_interview_date,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">7</span>,<span class="dv">4</span>) <span class="kw">as</span> <span class="dt">year</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">4</span>,<span class="dv">2</span>) <span class="kw">as</span> <span class="dt">month</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">1</span>,<span class="dv">2</span>) <span class="kw">as</span> <span class="dt">day</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">year</span>, <span class="dt">month</span>, <span class="dt">day</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>By default the <code>ORDER BY</code> clause will sort in ascending
order, smallest to biggest; we can make this explicit by usingthe
<code>ASC</code> keyword. Or if we want to sort in descending order we
can use the <code>DESC</code> keyword.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A01_interview_date,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">7</span>,<span class="dv">4</span>) <span class="kw">as</span> <span class="dt">year</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">4</span>,<span class="dv">2</span>) <span class="kw">as</span> <span class="dt">month</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">substr</span>(A01_interview_date,<span class="dv">1</span>,<span class="dv">2</span>) <span class="kw">as</span> <span class="dt">day</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">year</span> <span class="kw">DESC</span>, <span class="dt">month</span> <span class="kw">DESC</span>, <span class="dt">day</span> <span class="kw">DESC</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
</section><section id="using-sql-syntax-to-conditionally-create-new-values"><h2 class="section-heading">Using SQL syntax to conditionally create new values<a class="anchor" aria-label="anchor" href="#using-sql-syntax-to-conditionally-create-new-values"></a>
</h2>
<hr class="half-width">
<p>This format of the case statement allows you to check if various
values <strong>are equal</strong> to the value in the field given after
the <code>CASE</code> keyword.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">Id</span>, country,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>       <span class="cf">CASE</span> country</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>           <span class="cf">WHEN</span> <span class="st">'Moz'</span> <span class="cf">THEN</span> <span class="st">'Mozambique'</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>           <span class="cf">WHEN</span> <span class="st">'Taz'</span> <span class="cf">THEN</span> <span class="st">'Tanzania'</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>       <span class="cf">ELSE</span> <span class="st">'Unknown Country'</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>       <span class="cf">END</span> <span class="kw">AS</span> country_fullname</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>There is a more general form which allows to to perform any kind of
test.</p>
</section><section id="using-sql-syntax-to-create-binned-values"><h2 class="section-heading">Using SQL syntax to create ‘binned’ values<a class="anchor" aria-label="anchor" href="#using-sql-syntax-to-create-binned-values"></a>
</h2>
<hr class="half-width">
<p>It is often the case that we wish to convert a continuous variable
into a discrete factor type variable.</p>
<p>We can use a <code>CASE</code> statement to create this type of
effect.</p>
<p>The column <code>A11_years_farm</code> in the Farms table is an
indication of how many years the respondent has been on the farm. The
values are in years and range from 1 to 60. Instead of using individual
years we may want to group these values into ranges like 1-10, 11-20
etc. We can do this using a <code>CASE</code> statement as part of the
<code>SELECT</code> clause</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">Id</span>, A11_years_farm,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>       <span class="cf">CASE</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>           <span class="cf">WHEN</span>  A11_years_farm <span class="kw">BETWEEN</span> <span class="dv">1</span> <span class="kw">AND</span> <span class="dv">10</span> <span class="cf">THEN</span> <span class="st">'1-10'</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>           <span class="cf">WHEN</span>  A11_years_farm <span class="kw">BETWEEN</span> <span class="dv">11</span> <span class="kw">AND</span> <span class="dv">20</span> <span class="cf">THEN</span> <span class="st">'11-20'</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>           <span class="cf">WHEN</span>  A11_years_farm <span class="kw">BETWEEN</span> <span class="dv">21</span> <span class="kw">AND</span> <span class="dv">30</span> <span class="cf">THEN</span> <span class="st">'21-30'</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>           <span class="cf">WHEN</span>  A11_years_farm <span class="kw">BETWEEN</span> <span class="dv">31</span> <span class="kw">AND</span> <span class="dv">40</span> <span class="cf">THEN</span> <span class="st">'31-40'</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>           <span class="cf">WHEN</span>  A11_years_farm <span class="kw">BETWEEN</span> <span class="dv">41</span> <span class="kw">AND</span> <span class="dv">50</span> <span class="cf">THEN</span> <span class="st">'41-50'</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>           <span class="cf">WHEN</span>  A11_years_farm <span class="kw">BETWEEN</span> <span class="dv">41</span> <span class="kw">AND</span> <span class="dv">50</span> <span class="cf">THEN</span> <span class="st">'51-60'</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>       <span class="cf">ELSE</span> <span class="st">'&gt; 60'</span>       </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>       <span class="cf">END</span> <span class="kw">AS</span> A11_years_farm_range</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>New result columns can be created using arithmetic operators or
built-in functions</li>
<li>New columns have to be given names or aliases</li>
<li>The <code>CASE</code> coding structure can be used to create new
columns</li>
<li>The new columns are only in the query results. The original table is
not changed</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-06-aggregation"><p>Content from <a href="06-aggregation.html">Aggregations</a></p>
<hr>
<p>Last updated on 2023-05-02 |
        
        <a href="https://github.com/datacarpentry/sql-socialsci/edit/main/episodes/06-aggregation.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I summarise the data in my tables</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use the Distinct keyword to get a unique set of values</li>
<li>Use the ‘group by’ clause to summarise data</li>
<li>Use built-in statistical functions to provide column summaries</li>
<li>Use the ‘having’ clause to provide selection criteria to the summary
values</li>
<li>Understand the difference between the ‘where’ and the ‘having’
clauses</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="using-built-in-statistical-functions"><h2 class="section-heading">Using built-in statistical functions<a class="anchor" aria-label="anchor" href="#using-built-in-statistical-functions"></a>
</h2>
<hr class="half-width">
<p>Aggregate functions are used perform some kind of mathematical or
statistical calculation across a group of rows. The rows in each group
are determined by the different values in a specified column or columns.
Alternatively you can aggregate across the entire table.</p>
<p>If we wanted to know the minimum, average and maximum values of the
‘A11_years_farm’ column across the whole Farms table, we could write a
query such as this;</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">min</span>(A11_years_farm),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">max</span>(A11_years_farm),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">avg</span>(A11_years_farm)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms;</span></code></pre>
</div>
<p>This sort of query provides us with a general view of the values for
a particular column or field across the whole table.</p>
<p><code>min</code> , <code>max</code> and <code>avg</code> are built-in
aggregate functions in SQLite (and any other SQL database system). There
are other such functions available. A complete list can be found in the
SQLite documentation <a href="https://sqlite.org/lang_aggfunc.html" class="external-link">here</a>.</p>
<p>It is more likely that we would want to find such values for a range,
or multiple ranges of rows where each range is determined by the values
of some other column in the table. Before we do this we will look at how
we can find out what different values are contained in a given
column.</p>
</section><section id="the-distinct-keyword"><h2 class="section-heading">The <code>DISTINCT</code> keyword<a class="anchor" aria-label="anchor" href="#the-distinct-keyword"></a>
</h2>
<hr class="half-width">
<p>For the SAFI survey, it was known in advance all of the possible
values that certain variables of columns could contain. For example the
‘A06_province’, ‘A07_district’, ‘A08_ward’ and ‘A09_village’ variables
could only ever contain a few specific values.</p>
<p>As the SAFI survey was delivered via an Android phone app. It was
possible to create the app so that the possible values could be selected
from a dropdown list, eliminating any possibility of typing errors. For
the ‘A06_province’ there were only three possibilities, but by the time
we get down to ‘A09_villages’, a far more specific geography, it would
not have been possible to anticipate in advance all of the possible
values (village names) and so the values for this field were manually
typed in.</p>
<p>To obtain a list of unique values in a particular column we can use
the <code>DISTINCT</code> keyword.</p>
<p>Using the Farms table we will obtain a list of all of the different
values of the ‘A06_province’ column contained in the table.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> A06_province</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms;</span></code></pre>
</div>
<p>We can see from the results of running this that all 3 values are
represented and that there is no missing data in this field.</p>
<p>However if we run a similar query for ‘A09_village’</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> A09_village</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms;</span></code></pre>
</div>
<p>We get</p>
<figure><img src="../fig/SQL_06_villages.png" alt="Villages" class="figure mx-auto d-block"></figure><p>The problem with allowing free-form text quite obvious. Having two
villages, one called ‘Massequece’ and the other called ‘Massequese’ is
unlikely.</p>
<p>Detecting this type of problem in a large dataset can be very
difficult if you are just ‘eyeballing’ the content. This small SQL query
makes it very clear, and in the OpenRefine lesson we provide approaches
to detecting and correcting such errors. SQL is not the best tool for
correcting this type of error.</p>
<p>You can have more than one column name after the
<code>DISTINCT</code> keyword. In which case the results will include a
row for each unique <strong>combination</strong> of the columns
involved</p>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise"></a>
</h3>
<div class="callout-content">
<p>Write a query that will return all of the different combinations of
the ‘A06_province’, ‘A07_district’, ‘A08_ward’ and ‘A09_village’ columns
in the Farms table.</p>
<p>When looking at the results, you may have noticed that they are not
in any sorted order. Re-write the query so that the values of the four
columns are returned in alphabetical order.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> A06_province, A07_district, A08_ward, A09_village</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> A06_province, A07_district, A08_ward, A09_village;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="the-group-by-clause-to-summarise-data"><h2 class="section-heading">The <code>GROUP BY</code> clause to summarise data<a class="anchor" aria-label="anchor" href="#the-group-by-clause-to-summarise-data"></a>
</h2>
<hr class="half-width">
<p>Just knowing the combinations is of limited use. You really want to
know <strong>How many</strong> of each of the values there are. To do
this we use the <code>GROUP BY</code> clause.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A08_ward,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">AS</span> How_many</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> A08_ward;</span></code></pre>
</div>
<p>This query tells us how many records in the table have each different
value in the ‘A08_ward’ column.</p>
<p>In the first example of this episode, three aggregations were
performed over the single column ‘A11_years_farm’. In addition to
calculating multiple aggregation values over a single column, it is also
possible to aggregate over multiple columns by specifying them in all in
the <code>SELECT</code> clause <strong>and</strong> the
<code>GROUP BY</code> clause.</p>
<p>The grouping will take place based on the order of the columns listed
in the <code>GROUP BY</code> clause. There will be one row returned for
each unique combination of the columns mentioned in the
<code>GROUP BY</code> clause</p>
<p>What is not allowed is specifying a non-aggregated column in the
select clause which is not mentioned in the group by clause.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A06_province,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>       A07_district,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>       A08_ward,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>       A09_village,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">AS</span> How_many</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> A06_province, A07_district, A08_ward, A09_village</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<div id="exercise-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-1" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise-1"></a>
</h3>
<div class="callout-content">
<p>Write a query which returns the min, max and avg values as well as a
count of the number of records involved for the ‘A11_years_farm’ column
for each village in the ‘Nhamatanda’ district.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<pre><code>SELECT A09_village,
       min(A11_years_farm) AS min,
       max(A11_years_farm) AS max,
       avg(A11_years_farm) AS avg,
       count(*) AS how_many
FROM Farms
WHERE A07_district = 'Nhamatanda'
GROUP BY A09_village;</code></pre>
<p>Notice that you can use the ‘A07_district’ column in the
<code>WHERE</code> clause but it doesn’t have to appear in the
<code>SELECT</code> clause.</p>
</div>
</div>
</div>
</div>
</section><section id="using-the-having-clause"><h2 class="section-heading">Using the <code>HAVING</code> clause<a class="anchor" aria-label="anchor" href="#using-the-having-clause"></a>
</h2>
<hr class="half-width">
<p>In order to filter the rows returned in a non-aggregated query we
used the <code>WHERE</code> clause. For an aggregated query the
equivalent is the <code>HAVING</code> clause.</p>
<p>You use the <code>HAVING</code> clause by providing it with a filter
expression which references one or more of the aggregated columns.</p>
<p>In a <code>HAVING</code> clause you can use the column alias to refer
to the aggregated column.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A08_ward,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">min</span>(A11_years_farm) <span class="kw">AS</span> min_years,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">max</span>(A11_years_farm) <span class="kw">AS</span> max_years,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">AS</span> how_many_farms</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> A08_ward</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> how_many_farms <span class="op">&gt;</span> <span class="dv">2</span>;</span></code></pre>
</div>
<p>In this example we want to remove the wards which only have one or
two farms.</p>
<div id="exercise-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-2" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise-2"></a>
</h3>
<div class="callout-content">
<p>Using the Crops table write a query which will list all of the crops
(D_curr_crop) which are grown in over 100 plots.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> D_curr_crop,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">AS</span> how_many</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Crops</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> D_curr_crop</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> how_many <span class="op">&gt;</span> <span class="dv">100</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Built-in functions can be used to produce a variety of summary
statistics</li>
<li>The <code>DISTINCT</code> keyword can be used to find the unique set
of values in a column or columns</li>
<li>Data in columns can be summarised by values using the
<code>GROUP BY</code> clause</li>
<li>Summarised data can be filtered using the <code>HAVING</code>
clause</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-07-creating-tables-views"><p>Content from <a href="07-creating-tables-views.html">Creating tables and views</a></p>
<hr>
<p>Last updated on 2023-05-02 |
        
        <a href="https://github.com/datacarpentry/sql-socialsci/edit/main/episodes/07-creating-tables-views.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is the difference between a table and a view?</li>
<li>How can I create a table using the DB Browser for SQLite?</li>
<li>How can I create a table or view in DB Browser for SQLite using SQL
code?</li>
<li>How can I add records of data to a table?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the differences and similarities between Tables and
Views</li>
<li>Create table schemas using DB Browser for SQLite</li>
<li>Create table schemas and views using SQL code</li>
<li>Populate a table using SQL code</li>
<li>Populate a table from a file of data using DB Browser for
SQLite</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="using-sql-code-to-create-tables"><h2 class="section-heading">Using SQL code to create tables<a class="anchor" aria-label="anchor" href="#using-sql-code-to-create-tables"></a>
</h2>
<hr class="half-width">
<p>In relational databases, tables have to be created before you can add
data to them. The table definition that you create is referred to as the
<strong>Schema</strong> of the table.</p>
<p>The schema can contain many different properties of the table and the
data that it does/will contain. In its simplest form you only need to
specify a name for the table and a list of the column names and the data
types for each of those columns.</p>
<p>In this episode we will also show how the Farms, Plots and Crops
tables were created and populated from csv files. When we do this using
DB Browser, it appears to be a single step process, much like importing
a file into Excel. In fact it is always a two step process.
First……………</p>
</section><section id="using-the-db-browser-application-to-create-tables"><h2 class="section-heading">Using the DB Browser application to create tables<a class="anchor" aria-label="anchor" href="#using-the-db-browser-application-to-create-tables"></a>
</h2>
<hr class="half-width">
<p>So far we have created and populated tables from scratch or created
tables from existing tables. But initially your data is likely to be
external to the relational database system in a set of simple files.
Typically in CSV (comma separated values) or Tab delimited format.</p>
<p>All relational database systems will have some utility which will
allow you to import such files into tables in the database. The DB
Browser application has a nice GUI (Graphical Use Interface) to allow
you to do this.</p>
<p>The Farms, Plots and Crops tables that we have been using were
created in the DB Browser application by importing a CSV file containing
the data.</p>
<p>For large datasets this is a very common approach.</p>
<ol style="list-style-type: decimal">
<li><p>From the File menu select ‘Import’ and then ‘Table from CSV
file’. This will start the ‘Import CSV file’ wizard and you will be
asked to select the file of data you wish to import from a standard
Windows file open dialog.</p></li>
<li><p>After you have selected the file, you will be shown the ‘Import
CSV file’ window which will allow you to set a name for the table (the
default is taken from the filename). You will see the first few rows of
the data and there are a few options which can be changed if needs
be.</p></li>
</ol>
<figure><img src="../fig/SQL_07_Import_wizard_01.png" alt="Import table" class="figure mx-auto d-block"></figure><p>In our case all of the options are correctly set. If your file was in
Tab delimited format, you would need to change the ‘Field separator’
option to ‘Tab’. If your file did not have a header row with column
names you would un-check the appropriate box and DB Browser will
allocate names for the columns. (You can change them to more meaningful
names yourself after the import is complete)</p>
<ol start="3" style="list-style-type: decimal">
<li>When you click OK, a table will be created and the data loaded into
the table.</li>
</ol>
<p>Unfortunately this Import wizard in DB Browser does not do, or allow
you to do everything that you might want when creating a table. The most
obvious potential problem is that we were not allowed to specify the
data types to be associated with each of the columns in the table.
However, DB Browser will attempt to work out the appropriate data types
based on the values in the first few rows of the data. This is a very
common approach. (Earlier versions of DB Browser didn’t do this, it just
imported all of the columns as ‘Text’ data types.) If you go to the
table in the Database Structure tab and click the ‘&gt;’ you will see
all of the fields and they are all listed as either Text or Integer
fields.</p>
<p>If any of the datatypes are not as expected or wanted we can change
them.</p>
<ol start="4" style="list-style-type: decimal">
<li>Select the newly created table in Database Structure tab and click
the ‘Modify Table’ button in the toolbar. The ‘Edit Table Definition’
dialog will appear.</li>
</ol>
<figure><img src="../fig/SQL_07_Import_Wizard_02.png" alt="Modify Table" class="figure mx-auto d-block"></figure><p>In this particular case DB Browser correctly selected the datatypes.
Notice that the <code>A01_interview_date</code> was allocated a datatype
of ‘TEXT’. This isn’t a problem as we have to use the Date and Time
functions to manipulate dates anyway.</p>
<p>Notice that the bottom pane in the Window shows the SQL DDL statement
that would create the table that you modifying.</p>
<p>When you change one of the columns from TEXT to INTEGER, this is
immediately reflected in the Create Table statement.<br>
It is slightly misleading because in fact we are modifying an existing
table and in SQL-speak, this would be an <strong>Alter Table…</strong>
statement. However it does illustrate quite well the fact that whatever
you do in the GUI, it is essentially translated into an SQL statement
and executed. You could copy and paste this definition into the SQL
editor and if you change the table name before you ran it, you would
create a new table with that name. This new table would have no data in
it. This is how the insert table wizard works. It uses the header row
from your data to create a <code>CREATE TABLE</code> statement which it
runs. It then transforms each of the rows of data into SQL
<code>INSERT INTO...</code> statements which it also runs to get the
data into the table.</p>
<p>In addition to changing the data types there are several other
options which can be set when you are creating of modifying a table. For
our tables we don’t need to make use of them but for completeness we
will describe what they are;</p>
<p><strong>PK</strong> - Or Primary Key, a unique identifier for the
row. In the Farms table, there is an <code>Id</code> column which
uniquely identifies a Farm. This could act as a unique identifier for
the row as a whole. We could mark this as the primary key if we wanted
to.</p>
<p><strong>AI</strong> - Or Auto Increment. This isn’t really applicable
to tables created in this way, i.e. the creation of the schema
immediately followed by loading data from a file. It is usually used to
generate unique values for a column which could then act as a primary
key. If you have an ‘Auto Increment’ column in a table, when you insert
values you would not supply a value for the column as SQLite will
automatically provide a value for each row added.</p>
<p><strong>Not Null</strong> - If this is checked then it means that
there must be a value for each row in this column. If it is
<strong>not</strong> set and there is no value provided in the data then
it will be set to ‘NULL’ which means ‘I know nothing about what should
be here’. (Not the string ‘NULL’ but the NULL value)</p>
<p>In real datasets missing values are quite common and we have already
looked at ways of dealing with them when they occur in tables. If you
were to <strong>check</strong> this box and the data did have missing
values for this column, the record from the file would be rejected and
the load of the file will fail.</p>
<p><strong>U</strong> - Or Unique. This allows you to say that the
contents of the column, which is not the primary key column has to have
unique values in it. Like Allow Null this is another way of providing
some data validation as the data is imported. Although it doesn’t really
apply with the DB Browser import wizard as the data is imported before
you are allowed to set this option.</p>
<p><strong>Default</strong> - This is used in conjunction with ‘Not
Null’, if a value is not provided in the dataset, then if provided, the
default value for that column will be used.</p>
<p><strong>Check</strong> - This allows you to specify a constraint on
the values entered for the column. You could restrict the range of
values or compare the value with other columns values.</p>
<p>These three options, ‘Not Null’, ‘Unique’ and ‘Default’ , need to be
used with caution and certainly their use needs to be fully documented
and explained.</p>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise"></a>
</h3>
<div class="callout-content">
<p>From the Modify table dialog, change the <code>Id</code> column in
the <code>Farms</code> table to be the primary key. What difference did
it make in the <code>CREATE TABLE</code> statement?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>You need to scroll down to the bottom of the
<code>CREATE TABLE</code> statement to see the</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">PRIMARY</span> <span class="kw">KEY</span>(`Id`)</span></code></pre>
</div>
<p>line added.</p>
</div>
</div>
</div>
</div>
</section><section id="creating-a-table-using-an-sql-command"><h2 class="section-heading">Creating a table using an SQL command<a class="anchor" aria-label="anchor" href="#creating-a-table-using-an-sql-command"></a>
</h2>
<hr class="half-width">
<p>You could copy and paste this definition into the SQL editor and if
you change the table name before you ran it, you would create a new
table with that name. This new table would have no data in it. This is
how the insert table wizard works. It uses the header row from your data
to create a <code>CREATE TABLE</code> statement which it runs. It then
transforms each of the rows of data into SQL <code>INSERT INTO...</code>
statements which it also runs to get the data into the table.</p>
<p>For small tables defining them and populating them with data in this
way may be acceptable. But for larger tables this approach not only to
defining the tables but adding potentially thousands of rows of data can
be somewhat impractical.</p>
</section><section id="creating-tables-from-other-tables"><h2 class="section-heading">Creating tables from other tables<a class="anchor" aria-label="anchor" href="#creating-tables-from-other-tables"></a>
</h2>
<hr class="half-width">
<p>Whenever you write a Select query and run it, the results are always
in the form of a table. In the results pane, you can see the column
names and the rows of data in the results.</p>
<p>This provides a very easy way of creating a new table based on the
results of a query.</p>
<p>The following query selects a few of the columns from the Farms
table:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">Id</span>, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>       Country, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>       A06_province, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>       A07_district,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>       A08_ward, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>       A09_village</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms;</span></code></pre>
</div>
<p>If you want to make the results of this query into a new table, you
can do so by simply prefixing the <code>SELECT</code> with
<strong>CREATE TABLE NewTablename AS</strong> like this:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> Farms_location <span class="kw">AS</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">Id</span>, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>       Country, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>       A06_province, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>       A07_district,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>       A08_ward, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>       A09_village</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms;</span></code></pre>
</div>
<p>If we wanted to create a table from the Crops table which contains
only the rows where the D_curr_crop value was ‘rice’ we could use a
query like this:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> crops_rice <span class="kw">AS</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Crops</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> D_curr_crop <span class="op">=</span> <span class="st">'rice'</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>Here we want all of the columns from the Crops table but only if the
D_curr_crop value is ‘rice’.</p>
<p><strong>Note</strong>: please ensure that you run the code above as
we will use this new table in a later episode.</p>
</section><section id="using-sql-code-to-create-views"><h2 class="section-heading">Using SQL code to create views<a class="anchor" aria-label="anchor" href="#using-sql-code-to-create-views"></a>
</h2>
<hr class="half-width">
<p>In addition to tables all relational database systems have the
concept of ‘Views’. Views are based on tables. In the same way that we
were able to create a table based on a <code>SELECT</code> query, we can
create a ‘View’ in the same way. You just replace ‘Table’ with
‘View’.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">VIEW</span> Farms_location <span class="kw">AS</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">Id</span>, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>       Country, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>       A06_province, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>       A07_district,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>       A08_ward, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>       A09_village</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms;</span></code></pre>
</div>
<p>Tables and Views are so closely related that if you try to run the
code above, although ‘Table’ has been changed to ‘View’ you will get an
error complaining that the ‘Table’ already exists.</p>
<p>It is common practice when creating Views to indicate somewhere in
the name that it is in fact a View. e.g. vFarms_location or
Farms_location_v.</p>
<p>Although tables and views can be used almost interchangeably in
<code>SELECT</code> queries it is important to note that a
<code>View</code> unlike a <code>Table</code> contains no data. It is
essentially the SQL statement needed to produce that data from the
underlying data. This means that when you use a View there is the
overhead of having to run this SQL first. Although in practice the
Database system will combine the SQL required by the View and the other
SQL in your query so as to optimise how the SQL is executed.</p>
<p>The advantage of using Views is that it allows you to restrict how
you see the data in a table. In the example we used above it may be far
easier to work with only the 6 columns that we need from the full Farms
table rather than the full table with 61 columns.</p>
<p>A View isn’t restricted to simple <code>SELECT</code> statements it
can be the result of aggregations and joins as well. This can help
reduce the complexity of queries based on the View and so aid
readability.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Database tables can be created using the DDL command
<code>CREATE TABLE</code>
</li>
<li>They can be populated using the <code>INSERT INTO</code>
command</li>
<li>The SQLite plugin allows you to create a table and import data into
it in one step</li>
<li>There are many options available to the <code>CREATE TABLE</code>
command which allows greater control over how or what data can be loaded
into the table</li>
<li>A View can be treated just like a table in a query</li>
<li>A View does not contain data like a table does, only the
instructions on how to get the data</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-08-sqlite-command-line"><p>Content from <a href="08-sqlite-command-line.html">The SQLite command line</a></p>
<hr>
<p>Last updated on 2023-05-02 |
        
        <a href="https://github.com/datacarpentry/sql-socialsci/edit/main/episodes/08-sqlite-command-line.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 25 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I save my code in a file and run it again?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use the SQLite shell to re-run a file of SQL code</li>
<li>Save the output from the SQLite shell to a file</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="running-sql-code-using-the-sqlite-shell"><h2 class="section-heading">Running SQL code using the SQLite shell<a class="anchor" aria-label="anchor" href="#running-sql-code-using-the-sqlite-shell"></a>
</h2>
<hr class="half-width">
<p>Before you can run the SQLite3 shell program you must have installed
it. Instructions for doing this are included in the <a href="index.html#setup">set up procedures</a>.</p>
<p>I will assume that you have added the location of the program to your
local PATH environment variable as this will make it easier to refer to
the database file and other files we may want to use.</p>
<p>The instructions in this episode are written from a Windows user
perspective. If you are using Linux or a Mac, open a terminal window
instead a command prompt.</p>
<ol style="list-style-type: decimal">
<li>Open a command prompt (cmd.exe) and ‘cd’ to the folder location of
the SQL_SAFI.sqlite database file.</li>
<li>run the command ‘sqlite3’ This should open the SQLite shell and
present a screen similar to that below.</li>
</ol>
<figure><img src="../fig/SQL_08_SQLite_shell.png" alt="SQLite shell" class="figure mx-auto d-block"></figure><ol start="3" style="list-style-type: decimal">
<li>By default a “transient in-memory database” is opened. You can
change the database by use of the <em>.open</em> command</li>
</ol>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">.open</span> SQL_SAFI.sqlite</span></code></pre>
</div>
<p>It is important to remember the .sqlite suffix, otherwise a new
database simply called SQL_SAFI would be created</p>
<ol start="4" style="list-style-type: decimal">
<li>Once the database is opened you can run queries by typing directly
in the shell. Unlike in DB Browser, you must always terminate your
select command with a “;”. This is how the shell knows that
<strong>You</strong> think the statement is complete. Although easy to
forget, it generally works to your advantage as it allows you to split a
long query command across lines as you did in the DB Browser
application.</li>
</ol>
<figure><img src="../fig/SQL_08_SQLite_shell_query_example.png" alt="SQLite shell query example" class="figure mx-auto d-block"></figure><p>The output from the query is displayed on the screen. If we just
wanted to look at a small selection of data this may be OK. It is
however more likely that not only are the results from the query
somewhat larger, but also we would prefer to save the output to a file
for later use. There are some other changes to the output format that we
might want to change as well. for example; change the field separator
from the default “|” to a comma and provide column headers. This will
make the output more like a standard csv file.</p>
<p>Notice that the <code>NULL</code> values in columns 6 and 8 are just
left empty, two consecutive delimiters, just as they are in a csv
file.</p>
<p>We can make the changes we want by using further “dot” commands.</p>
<p>There are in fact a large number of “dot” commands and they are all
explained in the official SQLite documentation <a href="https://sqlite.org/cli.html" class="external-link">here</a>. One you will have to use at
some point is <code>.quit</code> which will end the SQLIte shell
program.</p>
<p>The commands we need are</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> .mode <span class="ex">csv</span></span></code></pre>
</div>
<p>to change the field separator to “,”. There are many other modes
available see the <a href="https://sqlite.org/cli.html" class="external-link">documentation</a>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> .header <span class="ex">on</span></span></code></pre>
</div>
<p>to show the column headers</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> .output <span class="ex">my.filename</span></span></code></pre>
</div>
<p>to direct the output to a file of my choice. The file will be created
if needed or it will overwrite an already existing file, so exercise
care.</p>
<figure><img src="../fig/SQL_08_SQLite_shell_dot_commands.png" alt="SQLite shell dot commands" class="figure mx-auto d-block"></figure><p>Yes you can have a file called “my.filename” if you want. The
contents of which contains the expected output from the query.</p>
<figure><img src="../fig/SQL_08_my_filename.png" alt="SQLite my.filename" class="figure mx-auto d-block"></figure><p>Notice the use of quotes in the rows where the value of the data item
themselves contain quotes; in this case single quotes.</p>
</section><section id="automating-the-use-of-the-sqlite-shell"><h2 class="section-heading">Automating the use of the SQLite shell<a class="anchor" aria-label="anchor" href="#automating-the-use-of-the-sqlite-shell"></a>
</h2>
<hr class="half-width">
<p>So far we have used the shell in much the same way as we might have
used the DB Browser application. We run the program, connect to a
database, run a query and save the output. Because the shell will accept
any valid SQL statements as well as have numerous ‘dot’ commands of it
own to configure how it works it could be considered as powerful as the
DB Browser application. You could use it as a replacement in most
cases.</p>
<p>Most people prefer to work with nice point and click interfaces, so
why would you want to use the shell rather than the DB Browser
application?</p>
<p>The shell has one distinct advantage over DB Browser; you can run the
shell program and in the call to the program provide a parameter
indicating the database to connect to and provide a file of the commands
that you want to execute. The shell will execute the file of commands
and then exit.</p>
<p>Here is an example</p>
<ol style="list-style-type: decimal">
<li>create a file <code>commands.sql</code> containing the following
content:</li>
</ol>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>result.csv</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>.<span class="kw">mode</span> csv</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>.output results.csv</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>.<span class="kw">open</span> SQL_SAFI.sqlite</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">from</span> Farms <span class="kw">where</span> A09_village<span class="op">=</span><span class="st">'God'</span>;</span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>run the sqlite3 program in the following way</li>
</ol>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sqlite3 <span class="op">&lt;</span> commands.sql</span></code></pre>
</div>
<p>Notice that there is no output to the screen and that the shell is
closed. The results of running the query have been placed in the
results.csv file.</p>
<p>There are two key advantages of using this approach.</p>
<ol style="list-style-type: decimal">
<li><p>It aids automation. It would be straightforward to have the one
line command line instruction to be run automatically, perhaps on a
timed basis. The SQL statements in the executed file doesn’t have to be
a simple query. It could be appending rows of data to a series of tables
which become available on a regular basis.</p></li>
<li><p>It aids reproducibility. Although it is convenient to use the DB
Browser application to play around and try things out, eventually you
will decide on approach, create relevant queries to perform your
analysis or research and at this point you will need to ensure that the
complete sequence is documented and is reproducible. This is what the
file of SQLite commands will do for you.</p></li>
</ol>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise"></a>
</h3>
<div class="callout-content">
<p>The query</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">from</span> Farms <span class="kw">WHERE</span> C01_respondent_roof_type <span class="op">=</span> <span class="st">'grass'</span>;</span></code></pre>
</div>
<p>returns all of the records from the Farms table which have a roof
made of grass.</p>
<p>Create a file of SQL statements and SQLite shell commands to create 3
files each containing the output from queries like the above but for all
three different roof types (grass, mabatisloping and mabatipitched)</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>The contents of your file should be something like this:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>.mode csv
.output grass_roofs.csv
select * from Farms where C01_respondent_roof_type = 'grass';
.output mabatisloping_roofs.csv
select * from Farms where C01_respondent_roof_type = 'mabatisloping';
.output mabatipitched_roofs.csv
select * from Farms where C01_respondent_roof_type = 'mabatipitched';</code></pre>
</div>
<p>The command to run it from the command line is:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sqlite3</span> SQL_SAFI.sqlite <span class="op">&lt;</span> SQLite_commands.sql</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>SQLite databases can be created, managed and queried from the SQLite
shell utility</li>
<li>You can run the shell interactively from the command line, typing
queries or dot commands at the prompt</li>
<li>You can call the SQLite3 program and specify a database and a set of
commands to run. This aids automation</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-09-joins"><p>Content from <a href="09-joins.html">Joins</a></p>
<hr>
<p>Last updated on 2023-05-02 |
        
        <a href="https://github.com/datacarpentry/sql-socialsci/edit/main/episodes/09-joins.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is meant by joining tables?</li>
<li>Why would I want to join tables?</li>
<li>What different types of joins are there?</li>
<li>How do Joins help you discover missing data or gaps in the data</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the structure of a joined table</li>
<li>Familiarity with the different join types</li>
<li>Use different join types in analysing your data</li>
<li>Understand what other join types can tell you about your data</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="about-table-joins"><h2 class="section-heading">About table joins<a class="anchor" aria-label="anchor" href="#about-table-joins"></a>
</h2>
<hr class="half-width">
<p>In any relational database system, the ability to join tables
together is a key querying requirement. Joins are used to combine the
columns from two (or more) tables together to form a single table. A
join between tables will only be possible if they have at least one
column in common. The column doesn’t have to have the same name in each
table, and quite often they won’t, but they do have to have a common
usage.</p>
<p>In the SAFI database we have three tables. Farms, Plots and Crops.
Each farm has a number of plots (or fields) and each plot can be used to
grow different crops. A question you might ask is: Which Farms with more
than 12 people in the household grow Maize? No single table has the
answer to this question.</p>
<p>We can write queries to answer each part separately</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- how many crops of Maize?</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Crops</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> D_curr_crop <span class="op">=</span> <span class="st">'maize'</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<figure><img src="../fig/SQL_09_maize.png" alt="Maize" class="figure mx-auto d-block"></figure><p>and</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Which farms have more than 12 in the Household</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">Id</span>, B_no_membrs</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> B_no_membrs <span class="op">&gt;</span> <span class="dv">12</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<figure><img src="../fig/SQL_09_maize.png" alt="Maize" class="figure mx-auto d-block"></figure><p>In order to answer the question we need information from both tables
at the time, i.e. from a single query. Notice that in the tables
returned by both of the above queries we have the <code>Id</code>
column. This column represents the Household or Farm in both of the
tables. Because of this we can use this <code>Id</code> column from both
tables to <code>JOIN</code> the tables together.</p>
<p>Providing we are confident that both of the columns represent the
household (or farm) it doesn’t matter whether or not they have the same
name.</p>
<p>We write a <code>JOIN</code> query like this:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> a.<span class="kw">Id</span>, a.B_no_membrs,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>       b.<span class="kw">Id</span>, b.D_curr_crop</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms <span class="kw">AS</span> a</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> Crops <span class="kw">AS</span> b</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> a.<span class="kw">Id</span> <span class="op">=</span> b.<span class="kw">Id</span> <span class="kw">AND</span> a.B_no_membrs <span class="op">&gt;</span> <span class="dv">12</span> <span class="kw">AND</span> b.D_curr_crop <span class="op">=</span> <span class="st">'maize'</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>There are several things to notice about this query:</p>
<ol style="list-style-type: decimal">
<li>We have used alias’ for the table names in the same way as we used
with columns in a previous lesson. In this case though, it is not to
provide more meaningful names, in fact alias’ for tables are often
single letters to save key strokes.</li>
<li>We use the table alias as a prefix, plus a ‘.’ when we refer to a
column name from the table. You don’t have to do this, but it generally
adds clarity to the query.</li>
<li>You will need to use an alias when you need to refer to a column
with the same name in both tables. In our case we need to compare the
<code>Id</code> column in both tables.</li>
<li>In the select clause, we list all of the columns, from both table
that we want in the output. We use the alias’ for clarity. If the column
name is not ambiguous, i.e it only occurs in one of the tables it can be
omitted, but as we have said it is better to leave it in for
clarity.</li>
<li>The name of the second table is given in the <code>JOIN</code>
clause.</li>
<li>The conditions of the <code>JOIN</code> are given in the
<code>ON</code> clause. The <code>ON</code> clause is very much like a
<code>WHERE</code> clause, in that you specific expressions which
restrict what rows are output. In our example we have three expressions.
The last two are the individual expressions we used in the previous,
single table queries. The first expression <code>a.Id = b.Id</code> is
the expression which determines how we want the two tables to be joined.
We are only interested in rows from both table where the <code>Id</code>
values match.</li>
</ol>
<p>When we run this query we get output like the following:</p>
<figure><img src="../fig/SQL_09_join1.png" alt="Join1" class="figure mx-auto d-block"></figure><div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>The output includes the <code>Id</code> column from both tables, how
could you have distinguished between them when you wrote the query?</li>
<li>Can you explain why there are two rows for <code>Id</code> 111? Can
you change the query so that these two different rows are being
correctly displayed?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> a.<span class="kw">Id</span> <span class="kw">AS</span> Farms_Id, a.B_no_membrs,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>       b.<span class="kw">Id</span> <span class="kw">AS</span> Crops_Id, b.plot_Id, b.D_curr_crop</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms <span class="kw">AS</span> a</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> Crops <span class="kw">AS</span> b</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> a.<span class="kw">Id</span> <span class="op">=</span> b.<span class="kw">Id</span> <span class="kw">AND</span> a.B_no_membrs <span class="op">&gt;</span> <span class="dv">12</span> <span class="kw">AND</span> b.D_curr_crop <span class="op">=</span> <span class="st">'maize'</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<ol style="list-style-type: decimal">
<li>we can add alias’ to the two <code>Id</code> columns to distinguish
them.</li>
<li>by adding the <code>plot_Id</code> column from the Crops table. It
is clear that <code>Id</code> 111 has two plots (plot 1 and plot 2)
growing maize.</li>
</ol>
</div>
</div>
</div>
</div>
</section><section id="different-join-types"><h2 class="section-heading">Different join types<a class="anchor" aria-label="anchor" href="#different-join-types"></a>
</h2>
<hr class="half-width">
<p>The example of a join given above is called an <strong>INNER</strong>
join, we could have written <strong>INNER JOIN</strong> rather than
simply <strong>JOIN</strong>. This is almost never done in practice as
the inner join is by far the most common join type used.</p>
<p>Other Join types are available…</p>
<p>Before we look at the other join types we need to explain how the
<strong>Inner join</strong> works and why it is so commonly used.</p>
<p>For any join (type) we are defining a relationship between two tables
based on the data values in two columns, one from each table. The
relationship is given by the criteria in the <code>ON</code> clause. The
value of the column in one table must be same as that in the other
table. That is; the criteria is given in the form
<code>value_in_column_from_table_a = value_in_column_from_table_b</code>.
Only if this criteria is TRUE will the requested columns from table_a
and table_b be returned as a single row in the output. During the join
process each row of the first with every row of the second and if a
match is found then a row combining the columns from both tables is
output.</p>
<p>Although typically the values being matched from the first table are
a unique (Distinct) set of values, the values in the second table don’t
have to be unique. This is why in the results of our previous query
there are two entries with Id 111. In the second table there are two
records with Id 111 and so the record from the first table gets combined
with both the records in the second table and two records are
output.</p>
<p>Because every Farm grows some crops, there will be at least one
record for each Id output. I for whatever reason the was a Farm with no
crops then there would be no record output for that Farm Id. Similarly
if there was an entry in the Crops table with an Id which didn’t match
any of the Ids in the Farms table, then it would not be output. There is
only an output record when the two columns have matching values.</p>
<p>When a relational database is defined and the tables set up initially
the relationship between the tables are already known, they are part of
the design of the overall database. Because of this it is possible to
ensure when the data is added to the tables that there will be entries
in both tables which have matching values. At the very least you can
prevent rows being added to the second table with a value in the column
you intend to join on for which there is no matching column in the first
table.</p>
<p>An inner join only returns rows where there is a match between the
two columns. In most cases this will be all of the columns selected from
the first table and 0,1 or more columns selected from the second
table.</p>
<p>The relational design makes use of multiple tables as a way of
avoiding repetition of data. Joining tables re-introduces the
replication of the data.</p>
</section><section id="there-are-several-different-join-types-possible"><h2 class="section-heading">There are several different join types possible<a class="anchor" aria-label="anchor" href="#there-are-several-different-join-types-possible"></a>
</h2>
<hr class="half-width">
<table class="table">
<colgroup>
<col width="7%">
<col width="92%">
</colgroup>
<thead><tr class="header">
<th>Join Type</th>
<th align="left">What it does</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Inner Join</td>
<td align="left">Matched rows in both tables are returned</td>
</tr>
<tr class="even">
<td>Left outer join</td>
<td align="left">All row in the left hand table are returned along with
the matches from the right hand table or NULLs if there is no match</td>
</tr>
<tr class="odd">
<td>Right outer join</td>
<td align="left">All row in the right hand table are returned along with
the matches from the left hand table or NULLs if there is no match</td>
</tr>
<tr class="even">
<td>Full outer join</td>
<td align="left">All rows from both tables are returned, with NULLs
where there are no matches</td>
</tr>
<tr class="odd">
<td>Cross join</td>
<td align="left">Each row in the first table will be matched with every
row in the second table. It is possible to imagine situations where this
is required but in most cases it is a mistake and un-intended.</td>
</tr>
</tbody>
</table>
<p>In SQLite only the <code>INNER JOIN</code>, the
<code>LEFT OUTER JOIN</code> and the <code>CROSS JOIN</code> are
supported. You can create a <code>Right outer join</code> by swapping
the tables in the <code>FROM</code> and <code>JOIN</code> clauses. A
<code>Full outer join</code> is the combination of the Left outer and
Right outer joins.</p>
</section><section id="using-different-join-types-in-analysing-your-data"><h2 class="section-heading">Using different join types in analysing your data<a class="anchor" aria-label="anchor" href="#using-different-join-types-in-analysing-your-data"></a>
</h2>
<hr class="half-width">
<p>In many cases the data you have in your tables may have come from
disparate sources, in that they do not form part of a
<strong>planned</strong> relational database. It has been your decision
to bring together (join) the data in the tables.</p>
<p>In order to do this at all you must be confident that the tables of
data do have columns which have a common set of values that you can join
on.</p>
<p>Assuming you do have a common column to join on, you can use an
<code>INNER JOIN</code> to combine the data.</p>
<p>However it will also be important for you to establish rows in both
of the tables for which there is no matching row in the other table.</p>
<ul>
<li>You may expect some to be missing</li>
<li>You may not care that some are missing</li>
<li>You may need to explain why some are missing</li>
</ul>
<p>To do this you will want to use a <code>FULL OUTER JOIN</code> or in
the case of SQLite a <code>LEFT OUTER JOIN</code> run twice using both
tables in the <code>FROM</code> and <code>JOIN</code> clauses. We can
demonstrate ability <code>LEFT OUTER JOIN</code> using the Crops_rice
table we created earlier.</p>
<p>The query below is similar to our original join except that we are
now joining with the crops_rice table and we have dropped the additional
criteria.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> a.<span class="kw">Id</span> <span class="kw">AS</span> Farms_Id, a.B_no_membrs,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>       b.<span class="kw">Id</span> <span class="kw">AS</span> Crops_Id, b.D_curr_crop</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms <span class="kw">AS</span> a</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">OUTER</span> <span class="kw">JOIN</span> Crops_rice <span class="kw">AS</span> b</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> a.<span class="kw">Id</span> <span class="op">=</span> b.<span class="kw">Id</span></span></code></pre>
</div>
<p>You can see from the results that there is an entry for every record
in the Farms table, but unless there is a crop of rice, the entries in
the columns from the crops_rice table are shown as NULL.</p>
<figure><img src="../fig/SQL_09_Left_Outer_Join_1.png" alt="Left Outer Join1" class="figure mx-auto d-block"></figure><div class="section level3">
<h3 id="joins-with-more-than-two-tables">Joins with more than two tables<a class="anchor" aria-label="anchor" href="#joins-with-more-than-two-tables"></a>
</h3>
<p>Joins are not restricted to just two tables. You can have any number,
but the more you have the more unreadable the SQL query is likely to
become. Quite often you can create views to hide this complexity.</p>
<p>Our original question was: ‘Which Farms with more than 12 people in
the household grow Maize?’ We found the number of people in the
household from the Farms table and the crops they grew in the crops
table. Suppose we now wanted to change the question to be: For Farms
with more than 12 people in the household how much land is devoted to
growing Maize? In addition to the previous requirements we now also need
the size of the plots growing maize. This information is only contained
in the <code>plots</code> table. The <code>plots</code> table has both
an Id column which we can use to join it with the Farms column. There is
also a plot_Id column which is used to indicate the number of the plot
within the Farm. The <code>crops</code> table also has a plot_id column
used for the same purpose.</p>
<p>However we cannot join the <code>plots</code> and the
<code>crops</code> table with just the <code>plot_id</code> column
because the <code>plot_id</code> column is not unique within the Plots
table. The <code>plot_id</code> is the plot number within a Farm. So
every Farm will have a plot_id with the value 1. In order to make what
we join on unique we need to use both the Id column and the plot_id
column together. This is allowed and quite commonly done.</p>
<p>Our new query now looks like this:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> a.<span class="kw">Id</span> <span class="kw">AS</span> Farms_Id, a.B_no_membrs,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>       b.<span class="kw">Id</span> , b.plot_id <span class="kw">AS</span> plot_id, b.D02_total_plot,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>       c.<span class="kw">Id</span> <span class="kw">AS</span> Crops_Id, c.plot_Id <span class="kw">AS</span> crops_plot_id, c.D_curr_crop</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms <span class="kw">AS</span> a</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> Plots <span class="kw">AS</span> b</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> Crops  <span class="kw">AS</span> c</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> a.<span class="kw">Id</span> <span class="op">=</span> b.<span class="kw">Id</span> <span class="kw">AND</span> (b.<span class="kw">Id</span> <span class="op">=</span> c.<span class="kw">Id</span> <span class="kw">AND</span> b.plot_id <span class="op">=</span> c.plot_id) <span class="kw">AND</span> a.B_no_membrs <span class="op">&gt;</span> <span class="dv">12</span> <span class="kw">AND</span> c.D_curr_crop <span class="op">=</span> <span class="st">'maize'</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
<p>Things to notice:</p>
<ol style="list-style-type: decimal">
<li>There is a <code>JOIN</code> clause for each of the additional
tables</li>
<li>But there is only one <code>ON</code> clause containing all of the
needed criteria.</li>
<li>The two criteria in brackets represents the join of the
<code>plots</code> table to the <code>Crops</code> table. (The brackets
aren’t needed, I just added them for clarity).</li>
</ol>
<p>The results look like this:</p>
<figure><img src="../fig/SQL_09_join5.png" alt="Left Outer Join1" class="figure mx-auto d-block"></figure><div id="exercise-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-1" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise-1"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Modify the query above so that only the ‘Id’, ‘D02_total_plot’ and
the ‘D_curr_crop’ columns are shown and at the same time summarise the
data so that there is only one entry for each Farm. i.e sum the
‘D02_total_plot’ column.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> a.<span class="kw">Id</span> <span class="kw">AS</span> Farms_Id,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">sum</span>(b.D02_total_plot) <span class="kw">AS</span> total_planted,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>       c.D_curr_crop</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Farms <span class="kw">AS</span> a</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> Plots <span class="kw">AS</span> b</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> Crops  <span class="kw">AS</span> c</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> a.<span class="kw">Id</span> <span class="op">=</span> b.<span class="kw">Id</span> <span class="kw">AND</span> (b.<span class="kw">Id</span> <span class="op">=</span> c.<span class="kw">Id</span> <span class="kw">AND</span> b.plot_id <span class="op">=</span> c.plot_id) <span class="kw">AND</span> a.B_no_membrs <span class="op">&gt;</span> <span class="dv">12</span> <span class="kw">AND</span> c.D_curr_crop <span class="op">=</span> <span class="st">'maize'</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> a.<span class="kw">Id</span>, c.D_curr_crop</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Joins are used to combine data from two or more tables.</li>
<li>Tables to be joined must have a column in each which represent the
same thing</li>
<li>There are several different types of joins</li>
<li>The Inner join is the most commonly use</li>
<li>You may have to use the other join types to discover missing data or
gaps in your data</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-10-other-environments"><p>Content from <a href="10-other-environments.html">Using database tables in other environments</a></p>
<hr>
<p>Last updated on 2023-05-02 |
        
        <a href="https://github.com/datacarpentry/sql-socialsci/edit/main/episodes/10-other-environments.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 15 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I save my query results for use by other programs or
applications?</li>
<li>What are and how do I use ODBC applications?</li>
<li>How can I access an SQLite database table from other programming
environments?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand what ODBC is and when it can be used</li>
<li>Construct appropriate connection strings</li>
<li>Appreciate the advantages of using ODBC to access a remote
database</li>
<li>Use an ODBC connection from Excel to retrieve data from a
database</li>
<li>Use ODBC from Python or other programming environment to retrieve
data from a database</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="odbc-and-advantages-of-using-it"><h2 class="section-heading">ODBC and advantages of using it<a class="anchor" aria-label="anchor" href="#odbc-and-advantages-of-using-it"></a>
</h2>
<hr class="half-width">
<p>ODBC - Open Database Connectivity (or Connector) is a piece of
software, often referred to as a <em>driver</em>, which allows a
database to be connected to an application or program. ODBC drivers are
specific to a given database system. As we are using an
<code>SQLite</code> database we need an SQLite specific ODBC driver to
connect to it.</p>
<p>The installation of the SQLite ODBC driver for a Windows machine is
explained in the <a href="index.html#setup">SQL setup document</a> .</p>
<p>So far in this lesson we have accessed our SQLite database either
through the DB Browser application or directly using the command line
shell. Each of these methods have their own advantages. The DB Browser
application provides a simple GUI (Graphical User Interface), for
development and testing new queries. The shell aids automation of tasks
such as adding rows to a table or allowing whole scripts of SQL commands
to be run consecutively without user intervention. In both of these
methods, we have seen that the ‘outputs’ can be saved to
<code>csv</code> files from where they can be read into other
applications or programs for futher processing. Using ODBC misses out
the middle man (the file of output). The application or program connects
directly to the SQLite database, sends it an SQL query, receives the
output from that query and processes the results in an appropriate
fashion.</p>
<p>In the case of Excel the tabular results of the query are displayed
in a worksheet. For R and Python the results are assigned to a suitable
variable from where they can be examined or further processed.</p>
<p>In the following sections we will give examples of using ODBC to
connect to Excel and also accessing SQLite from R and Python
programs.</p>
</section><section id="connection-strings"><h2 class="section-heading">Connection strings<a class="anchor" aria-label="anchor" href="#connection-strings"></a>
</h2>
<hr class="half-width">
<p>A connection string is really just a list of parameters and their
values which explain to the ODBC driver what database you wish to
connect to and how you wish to use it. For some database systems this
might involve providing user credentials as well as specifying which
particular database you want to access. For our use of SQLite, the
connection string is essentially the full pathname and filename of the
SQLite database file.</p>
<p>How and where the connection string information is provided depends
on the ODBC driver and the application or program being used.</p>
</section><section id="connecting-to-excel-using-odbc"><h2 class="section-heading">Connecting to Excel using ODBC<a class="anchor" aria-label="anchor" href="#connecting-to-excel-using-odbc"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="walkthrough-example">Walkthrough example<a class="anchor" aria-label="anchor" href="#walkthrough-example"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Open an empty Excel workbook</li>
<li>From the Data ribbon select Get Data | From other Sources | From
Microsoft Query</li>
<li>From the Choose Data Source window select
<code>SQLite3 Datasource</code> and click <strong>OK</strong>.</li>
</ol>
<figure><img src="../fig/SQL_10_DataSource.png" alt="SQL_10_DataSource" class="figure mx-auto d-block"></figure><p>If this option does not appear in the list, then it probably means
that the SQLite ODBC driver has not been installed.</p>
<ol start="4" style="list-style-type: decimal">
<li><p>The ‘Connect’ window is where you specify the connection string
information. You can see that there are many things that can be
specified. But all we need to specify is the Database name i.e. the full
path and name of the database file. There is a browse button you can use
to navigate to the required file. When you have selected the database
file click <strong>OK</strong></p></li>
<li><p>At this point, you may get an a window pop up saying that there
are no tables</p></li>
</ol>
<figure><img src="../fig/SQL_10_No_Tables.png" alt="SQL_10_No_Tables" class="figure mx-auto d-block"></figure><p>Click <strong>OK</strong> . The Choose Columns Windows appears to
support the ‘no tables’ assertion.</p>
<figure><img src="../fig/SQL_10_Choose_Columns.png" alt="SQL_10_Choose_Columns" class="figure mx-auto d-block"></figure><p>Click on the <code>options</code> button and then toggle the
<strong>system tables</strong> option and click <strong>OK</strong>,
then the tables will appear.</p>
<p>(There is no technical reason why the above procedure to see the
tables should be necessary, it appears to be a fault in the ODBC driver,
which fortunately we can work around.)</p>
<figure><img src="../fig/SQL_10_Choose_Columns_2.png" alt="SQL_10_Choose_Columns_2" class="figure mx-auto d-block"></figure><p>Select the Farms table and then click the ‘&gt;’ button to select all
of the columns from the Farms table. They will be displayed in the right
hand pane. This is the equivalent of the <code>SELECT *</code> SQL
clause that we have used before. If you click the ‘+’ button to the left
of the table name, a full list of the column names is displayed allowing
you to select individual columns for inclusion. Click
<strong>Next</strong></p>
<ol start="6" style="list-style-type: decimal">
<li>Subsequent windows allow you to filter the rows returned, this is
equivalent to adding a <code>WHERE</code> clause to the query and
finally you can have the returned rows sorted, equivalent to a
<code>SORT BY</code> clause. We shall just default these options. The
final window asks us if we want to return the data to Excel or further
edit the query we have built up using Microsoft query. We will leave the
default action of rturning the data to Excel. Click
<strong>Finish</strong>
</li>
</ol>
<p>The overall effect of this wizard is to construct an SQL query, in
this case <code>SELECT * FROM Farms</code> send it to the SQLite system
to be run and then to recieve back the results.</p>
<figure><img src="../fig/SQL_10_return_data.png" alt="SQL_10_return_data" class="figure mx-auto d-block"></figure><ol start="7" style="list-style-type: decimal">
<li>Although the wizard has finished we still need to say where we want
the data placed in our workbook. We will accept the default position of
the ‘A1’ cell in the current workbook.</li>
</ol>
<figure><img src="../fig/SQL_10_place_data.png" alt="SQL_10_place_data" class="figure mx-auto d-block"></figure><p>The data is returned as an Excel <code>Table</code>. All of the
columns have their headings included and have filter buttons attached.
You can now manipulate the data in Excel as you would any other
data.</p>
</div>
</section><section id="connecting-to-python-or-other-programming-environments-using-odbc"><h2 class="section-heading">Connecting to Python or other programming environments using
ODBC<a class="anchor" aria-label="anchor" href="#connecting-to-python-or-other-programming-environments-using-odbc"></a>
</h2>
<hr class="half-width">
<p>Both Python and R (and many other programming languages) provide
methods of connecting to and extracting data from SQLite databases. Full
details and examples are provided in the Python lesson and the R
lesson.</p>
<p>For now we will just look at code examples in Python and R, both of
which run the same query as we used for the Excel example above.</p>
<div class="section level4">
<h4 id="python">Python<a class="anchor" aria-label="anchor" href="#python"></a>
</h4>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>con <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="vs">r'C:/Users/pfsmy/OneDrive/UoM/Carpentry/Datasets/SN7577.sqlite'</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>cur <span class="op">=</span> con.cursor()</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>cur.execute(<span class="st">"SELECT * FROM SN7577"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> cur.fetchall()</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> rows:</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>con.close()</span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="r">R<a class="anchor" aria-label="anchor" href="#r"></a>
</h4>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"RSQLite"</span><span class="op">)</span></span>
<span><span class="va">dbfile</span> <span class="op">=</span> <span class="st">"C:/Users/pfsmy/OneDrive/UoM/Carpentry/Datasets/SN7577.sqlite"</span></span>
<span><span class="va">sqlite</span> <span class="op">=</span> <span class="fu">dbDriver</span><span class="op">(</span><span class="st">"SQLite"</span><span class="op">)</span></span>
<span><span class="va">mydb</span> <span class="op">=</span> <span class="fu">dbConnect</span><span class="op">(</span><span class="va">sqlite</span>, <span class="va">dbfile</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">=</span> <span class="fu">dbSendQuery</span><span class="op">(</span><span class="va">mydb</span>, <span class="st">"SELECT * FROM SN7577"</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="fu">fetch</span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="va">data</span></span>
<span><span class="fu">dbClearResult</span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code></pre>
</div>
<p>We will not discuss the working of the code, that is covered in the
Python and R lessons. Even without coding experience of these languages,
you will be able to spot that in both cases we need to specify a
connection string (the SQLite database filename) and also the text of
the query itself.</p>
<p>In both cases the results are stored in a variable object of the
language.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>ODBC - Open DataBase Connector allows a database to be connected to
a program or application</li>
<li>Each database system has its own ODBC connectors</li>
<li>Programs such as Excel allow you to use ODBC to get data from
databases</li>
<li>Programming languages such as Python and R provide libraries which
facilitate ODBC connections</li>
</ul>
</div>
</div>
</div>
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/datacarpentry/sql-socialsci/edit/main/README.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/datacarpentry/sql-socialsci/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/datacarpentry/sql-socialsci/" class="external-link">Source</a></p>
				<p><a href="https://github.com/datacarpentry/sql-socialsci/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.2" class="external-link">sandpaper (0.16.2)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://datacarpentry.github.io/sql-socialsci/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://datacarpentry.github.io/sql-socialsci/instructor/aio.html",
  "identifier": "https://datacarpentry.github.io/sql-socialsci/instructor/aio.html",
  "dateCreated": "2017-05-25",
  "dateModified": "2024-01-30",
  "datePublished": "2024-01-30"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

